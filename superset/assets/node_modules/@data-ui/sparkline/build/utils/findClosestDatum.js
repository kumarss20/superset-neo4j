'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = findClosestDatum;

var _d3Array = require('d3-array');

var _localPoint2 = require('@vx/event/build/localPoint');

var _localPoint3 = _interopRequireDefault(_localPoint2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function findClosestDatum(_ref) {
  var data = _ref.data,
      getX = _ref.getX,
      xScale = _ref.xScale,
      event = _ref.event;

  if (!event || !event.target || !event.target.ownerSVGElement) return {};
  var bisect = (0, _d3Array.bisector)(getX).right;
  // if the g element has a transform we need to be in g coords not svg coords
  var gElement = event.target.ownerSVGElement.firstChild;

  var _localPoint = (0, _localPoint3.default)(gElement, event),
      x = _localPoint.x;

  var dataX = xScale.invert(x);
  var index = bisect(data, dataX, 1);
  var d0 = data[index - 1];
  var d1 = data[index];
  var d = !d0 || Math.abs(dataX - getX(d0)) > Math.abs(dataX - getX(d1)) ? d1 : d0;
  return {
    datum: d,
    index: d === d0 ? index - 1 : index
  };
}