function _extends(){return _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}/* eslint compat/compat: 'off' */import"whatwg-fetch";import{CACHE_AVAILABLE,CACHE_KEY,HTTP_STATUS_NOT_MODIFIED,HTTP_STATUS_OK}from"../constants";// This function fetches an API response and returns the corresponding json
export default function callApi(a){var b=a.body,c=a.cache,d=void 0===c?"default":c,e=a.credentials,f=void 0===e?"same-origin":e,g=a.headers,h=a.method,i=void 0===h?"GET":h,j=a.mode,k=void 0===j?"same-origin":j,l=a.postPayload,m=a.redirect,n=void 0===m?"follow":m,o=a.signal,p=a.stringify,q=a.url,r={body:b,cache:d,credentials:f,headers:g,method:i,mode:k,redirect:n,signal:o};if("GET"===i&&CACHE_AVAILABLE&&"https:"===(self.location&&self.location.protocol))return caches.open(CACHE_KEY).then(function(a){return a.match(q).then(function(a){if(a){// if we have a cached response, send its ETag in the
// `If-None-Match` header in a conditional request
var b=a.headers.get("Etag");r.headers=_extends({},r.headers,{"If-None-Match":b})}return fetch(q,r)}).then(function(b){return b.status===HTTP_STATUS_NOT_MODIFIED?a.match(q).then(function(a){if(a)return a.clone();throw new Error("Received 304 but no content is cached!")}):(b.status===HTTP_STATUS_OK&&b.headers.get("Etag")&&(a.delete(q),a.put(q,b.clone())),b)})});if(("POST"===i||"PATCH"===i||"PUT"===i)&&"object"==typeof l){// using FormData has the effect that Content-Type header is set to `multipart/form-data`,
// not e.g., 'application/x-www-form-urlencoded'
var s=new FormData;Object.keys(l).forEach(function(a){var b=l[a];"undefined"!=typeof b&&s.append(a,!(void 0!==p)||p?JSON.stringify(b):b)}),r.body=s}return fetch(q,r)}