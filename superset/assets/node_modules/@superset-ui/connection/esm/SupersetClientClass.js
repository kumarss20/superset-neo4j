function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}function _extends(){return _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:/* force = */!0,configurable:!0,writable:!0}):a[b]=c,a}import callApi from"./callApi";var SupersetClientClass=/*#__PURE__*/function(){function a(a){var b=void 0===a?{}:a,c=b.protocol,d=void 0===c?"http:":c,e=b.host,f=void 0===e?"localhost":e,g=b.headers,h=void 0===g?{}:g,i=b.mode,j=void 0===i?"same-origin":i,k=b.timeout,l=b.credentials,m=void 0===l?void 0:l,n=b.csrfToken,o=void 0===n?void 0:n;_defineProperty(this,"credentials",void 0),_defineProperty(this,"csrfToken",void 0),_defineProperty(this,"csrfPromise",void 0),_defineProperty(this,"protocol",void 0),_defineProperty(this,"host",void 0),_defineProperty(this,"headers",void 0),_defineProperty(this,"mode",void 0),_defineProperty(this,"timeout",void 0),this.headers=_extends({},h),this.host=f,this.mode=j,this.timeout=k,this.protocol=d,this.credentials=m,this.csrfToken=o,this.csrfPromise=void 0,"string"==typeof this.csrfToken&&(this.headers=_extends({},this.headers,{"X-CSRFToken":this.csrfToken}),this.csrfPromise=Promise.resolve(this.csrfToken))}var b=a.prototype;return b.init=function init(a){return void 0===a&&(a=!1),this.isAuthenticated()&&!a?this.csrfPromise:this.getCSRFToken()},b.isAuthenticated=function isAuthenticated(){// if CSRF protection is disabled in the Superset app, the token may be an empty string
return null!==this.csrfToken&&void 0!==this.csrfToken},b.get=/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.request(_extends({},b,{method:"GET"})));case 1:case"end":return a.stop();}},a,this)}));return function get(){return a.apply(this,arguments)}}(),b.delete=/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.request(_extends({},b,{method:"DELETE"})));case 1:case"end":return a.stop();}},a,this)}));return function _delete(){return a.apply(this,arguments)}}(),b.put=/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.request(_extends({},b,{method:"PUT"})));case 1:case"end":return a.stop();}},a,this)}));return function put(){return a.apply(this,arguments)}}(),b.post=/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.request(_extends({},b,{method:"POST"})));case 1:case"end":return a.stop();}},a,this)}));return function post(){return a.apply(this,arguments)}}(),b.request=/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p=this;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=b.body,d=b.credentials,e=b.endpoint,f=b.headers,g=b.host,h=b.method,i=b.mode,j=b.parseMethod,k=b.postPayload,l=b.signal,m=b.stringify,n=b.timeout,o=b.url,a.abrupt("return",this.ensureAuth().then(function(){return callApi({body:c,credentials:d||p.credentials,headers:_extends({},p.headers,{},f),method:h,mode:i||p.mode,parseMethod:j,postPayload:k,signal:l,stringify:m,timeout:n||p.timeout,url:p.getUrl({endpoint:e,host:g,url:o})})}));case 2:case"end":return a.stop();}},a,this)}));return function request(){return a.apply(this,arguments)}}(),b.ensureAuth=function ensureAuth(){return this.csrfPromise||Promise.reject({error:"SupersetClient has no CSRF token, ensure it is initialized or\n        try logging into the Superset instance at "+this.getUrl({endpoint:"/login"})})},b.getCSRFToken=/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){var b=this;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this.csrfToken=void 0,this.csrfPromise=callApi({credentials:this.credentials,headers:_extends({},this.headers),method:"GET",mode:this.mode,timeout:this.timeout,url:this.getUrl({endpoint:"superset/csrf_token/"})}).then(function(a){return"object"==typeof a.json&&(b.csrfToken=a.json.csrf_token,"string"==typeof b.csrfToken&&(b.headers=_extends({},b.headers,{"X-CSRFToken":b.csrfToken}))),b.isAuthenticated()?b.csrfToken:Promise.reject({error:"Failed to fetch CSRF token"})}),a.abrupt("return",this.csrfPromise);case 3:case"end":return a.stop();}},a,this)}));return function getCSRFToken(){return a.apply(this,arguments)}}(),b.getUrl=function getUrl(a){var b=void 0===a?{}:a,c=b.host,d=b.endpoint,e=void 0===d?"":d,f=b.url;if("string"==typeof f)return f;var g=c||this.host,h="/"===g.slice(-1)?g.slice(0,-1):g;// no backslash
return this.protocol+"//"+h+"/"+("/"===e[0]?e.slice(1):e)},a}();export{SupersetClientClass as default};