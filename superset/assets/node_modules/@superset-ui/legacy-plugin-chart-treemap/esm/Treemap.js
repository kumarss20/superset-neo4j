var _this=this,_arguments=arguments;/**
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */ /* eslint-disable no-param-reassign, sort-keys */ /* eslint-disable func-names, no-magic-numbers, babel/no-invalid-this */import{select as d3Select,selectAll as d3SelectAll}from"d3-selection";import{treemap as d3Treemap,hierarchy as d3Hierarchy,treemapSquarify}from"d3-hierarchy";import PropTypes from"prop-types";import{CategoricalColorNamespace}from"@superset-ui/color";import{getNumberFormatter}from"@superset-ui/number-format";import"./Treemap.css";// Declare PropTypes for recursive data structures
// https://github.com/facebook/react/issues/5676
/* eslint-disable-next-line  no-undef */var lazyFunction=function(a){return function(){return a().apply(_this,_arguments)}},leafType=PropTypes.shape({name:PropTypes.string,value:PropTypes.number.isRequired}),parentShape={name:PropTypes.string,children:PropTypes.arrayOf(PropTypes.oneOfType([PropTypes.shape(lazyFunction(function(){return parentShape})),leafType]))},nodeType=PropTypes.oneOfType([PropTypes.shape(parentShape),leafType]),propTypes={data:PropTypes.arrayOf(nodeType),width:PropTypes.number,height:PropTypes.number,colorScheme:PropTypes.string,margin:PropTypes.shape({top:PropTypes.number,right:PropTypes.number,bottom:PropTypes.number,left:PropTypes.number}),numberFormat:PropTypes.string,treemapRatio:PropTypes.number};function hovered(a){return function(b){d3SelectAll(b.ancestors().map(function(a){return a.node})).classed("node--hover",a).select("rect").attr("width",function(b){return b.x1-b.x0-a}).attr("height",function(b){return b.y1-b.y0-a})}}/* Modified from https://bl.ocks.org/mbostock/911ad09bdead40ec0061 */function Treemap(a,b){var c=b.data,d=b.width,e=b.height,f=b.numberFormat,g=b.colorScheme,h=b.treemapRatio,i=d3Select(a);i.classed("superset-legacy-chart-treemap",!0);var j=getNumberFormatter(f),k=CategoricalColorNamespace.getScale(g),l=c;if(i.selectAll("*").remove(),0<l.length){var m=l[0],n=d3Treemap().size([d,e]).paddingOuter(3).paddingTop(19).paddingInner(1).tile(treemapSquarify.ratio(h)).round(!0),o=n(d3Hierarchy(m).sum(function(a){return a.value}).sort(function(c,a){return a.height-c.height||a.value-c.value})),p=i.append("svg").attr("class","treemap").attr("width",d).attr("height",e),q=p.selectAll(".node").data(o.descendants()).enter().append("g").attr("transform",function(a){return"translate("+a.x0+","+a.y0+")"}).attr("class","node").each(function(a){a.node=this}).on("mouseover",hovered(!0)).on("mouseout",hovered(!1));q.append("rect").attr("id",function(a){return"rect-"+a.data.name}).attr("width",function(a){return a.x1-a.x0}).attr("height",function(a){return a.y1-a.y0}).style("fill",function(a){return k(a.depth)}),q.append("clipPath").attr("id",function(a){return"clip-"+a.data.name}).append("use").attr("xlink:href",function(a){return"#rect-"+a.data.name});var r=q.append("text").attr("clip-path",function(a){return"url(#clip-"+a.data.name+")"});r.filter(function(a){return a.children}).selectAll("tspan").data(function(a){return a.data.name.substring(a.data.name.lastIndexOf(".")+1).split(/(?=[A-Z][^A-Z])/g).concat("\xA0"+j(a.value))}).enter().append("tspan").attr("x",function(a,b){return b?null:4}).attr("y",13).text(function(a){return a}),r.filter(function(a){return!a.children}).selectAll("tspan").data(function(a){return a.data.name.substring(a.data.name.lastIndexOf(".")+1).split(/(?=[A-Z][^A-Z])/g).concat(j(a.value))}).enter().append("tspan").attr("x",4).attr("y",function(a,b){return 13+10*b}).text(function(a){return a}),q.append("title").text(function(a){return a.data.name+"\n"+j(a.value)})}}Treemap.displayName="Treemap",Treemap.propTypes=propTypes;export default Treemap;