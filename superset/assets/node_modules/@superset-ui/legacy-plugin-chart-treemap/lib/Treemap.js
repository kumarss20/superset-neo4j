"use strict";var _this=void 0,_arguments=arguments;exports.__esModule=!0,exports.default=void 0;var _d3Selection=require("d3-selection"),_d3Hierarchy=require("d3-hierarchy"),_propTypes=_interopRequireDefault(require("prop-types")),_color=require("@superset-ui/color"),_numberFormat=require("@superset-ui/number-format");require("./Treemap.css");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}// Declare PropTypes for recursive data structures
// https://github.com/facebook/react/issues/5676
/* eslint-disable-next-line  no-undef */var lazyFunction=function(a){return function(){return a().apply(_this,_arguments)}},leafType=_propTypes.default.shape({name:_propTypes.default.string,value:_propTypes.default.number.isRequired}),parentShape={name:_propTypes.default.string,children:_propTypes.default.arrayOf(_propTypes.default.oneOfType([_propTypes.default.shape(lazyFunction(function(){return parentShape})),leafType]))},nodeType=_propTypes.default.oneOfType([_propTypes.default.shape(parentShape),leafType]),propTypes={data:_propTypes.default.arrayOf(nodeType),width:_propTypes.default.number,height:_propTypes.default.number,colorScheme:_propTypes.default.string,margin:_propTypes.default.shape({top:_propTypes.default.number,right:_propTypes.default.number,bottom:_propTypes.default.number,left:_propTypes.default.number}),numberFormat:_propTypes.default.string,treemapRatio:_propTypes.default.number};function hovered(a){return function(b){(0,_d3Selection.selectAll)(b.ancestors().map(function(a){return a.node})).classed("node--hover",a).select("rect").attr("width",function(b){return b.x1-b.x0-a}).attr("height",function(b){return b.y1-b.y0-a})}}/* Modified from https://bl.ocks.org/mbostock/911ad09bdead40ec0061 */function Treemap(a,b){var c=b.data,d=b.width,e=b.height,f=b.numberFormat,g=b.colorScheme,h=b.treemapRatio,i=(0,_d3Selection.select)(a);i.classed("superset-legacy-chart-treemap",!0);var j=(0,_numberFormat.getNumberFormatter)(f),k=_color.CategoricalColorNamespace.getScale(g),l=c;if(i.selectAll("*").remove(),0<l.length){var m=l[0],n=(0,_d3Hierarchy.treemap)().size([d,e]).paddingOuter(3).paddingTop(19).paddingInner(1).tile(_d3Hierarchy.treemapSquarify.ratio(h)).round(!0),o=n((0,_d3Hierarchy.hierarchy)(m).sum(function(a){return a.value}).sort(function(c,a){return a.height-c.height||a.value-c.value})),p=i.append("svg").attr("class","treemap").attr("width",d).attr("height",e),q=p.selectAll(".node").data(o.descendants()).enter().append("g").attr("transform",function(a){return"translate("+a.x0+","+a.y0+")"}).attr("class","node").each(function(a){a.node=this}).on("mouseover",hovered(!0)).on("mouseout",hovered(!1));q.append("rect").attr("id",function(a){return"rect-"+a.data.name}).attr("width",function(a){return a.x1-a.x0}).attr("height",function(a){return a.y1-a.y0}).style("fill",function(a){return k(a.depth)}),q.append("clipPath").attr("id",function(a){return"clip-"+a.data.name}).append("use").attr("xlink:href",function(a){return"#rect-"+a.data.name});var r=q.append("text").attr("clip-path",function(a){return"url(#clip-"+a.data.name+")"});r.filter(function(a){return a.children}).selectAll("tspan").data(function(a){return a.data.name.substring(a.data.name.lastIndexOf(".")+1).split(/(?=[A-Z][^A-Z])/g).concat("\xA0"+j(a.value))}).enter().append("tspan").attr("x",function(a,b){return b?null:4}).attr("y",13).text(function(a){return a}),r.filter(function(a){return!a.children}).selectAll("tspan").data(function(a){return a.data.name.substring(a.data.name.lastIndexOf(".")+1).split(/(?=[A-Z][^A-Z])/g).concat(j(a.value))}).enter().append("tspan").attr("x",4).attr("y",function(a,b){return 13+10*b}).text(function(a){return a}),q.append("title").text(function(a){return a.data.name+"\n"+j(a.value)})}}Treemap.displayName="Treemap",Treemap.propTypes=propTypes;var _default=Treemap;exports.default=_default;