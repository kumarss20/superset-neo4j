"use strict";exports.__esModule=!0,exports.default=void 0;var _d=_interopRequireDefault(require("d3")),_propTypes=_interopRequireDefault(require("prop-types")),_d3Sankey=require("d3-sankey"),_color=require("@superset-ui/color"),_numberFormat=require("@superset-ui/number-format");require("./Sankey.css");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}/**
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */ /* eslint-disable no-param-reassign, no-magic-numbers, sort-keys, babel/no-invalid-this */var propTypes={data:_propTypes.default.arrayOf(_propTypes.default.shape({source:_propTypes.default.string,target:_propTypes.default.string,value:_propTypes.default.number})),width:_propTypes.default.number,height:_propTypes.default.number,colorScheme:_propTypes.default.string},formatNumber=(0,_numberFormat.getNumberFormatter)(_numberFormat.NumberFormats.FLOAT);function Sankey(a,b){function c(a){var b;if(a.sourceLinks)// is node
b=a.name+" Value: <span class='emph'>"+formatNumber(a.value)+"</span>";else{var c=formatNumber(a.value),d=_d.default.round(100*(a.value/a.source.value),1),e=_d.default.round(100*(a.value/a.target.value),1);b=["<div class=''>Path Value: <span class='emph'>",c,"</span></div>","<div class='percents'>","<span class='emph'>",Number.isFinite(d)?d:"100","%</span> of ",a.source.name,"<br/>","<span class='emph'>"+(Number.isFinite(e)?e:"--")+"%</span> of ",a.target.name,"target","</div>"].join("")}return b}function d(a){o.html(function(){return c(a)}).transition().duration(200).style("left",_d.default.event.offsetX+10+"px").style("top",_d.default.event.offsetY+10+"px").style("opacity",.95)}function e(){o.transition().duration(100).style("opacity",0)}var f=b.data,g=b.width,h=b.height,i=b.colorScheme,j=_d.default.select(a);j.classed("superset-legacy-chart-sankey",!0);var k={top:5,right:5,bottom:5,left:5},l=g-k.left-k.right,m=h-k.top-k.bottom;j.selectAll("*").remove();var n=j.append("svg").attr("width",l+k.left+k.right).attr("height",m+k.top+k.bottom).append("g").attr("transform","translate("+k.left+","+k.top+")"),o=j.append("div").attr("class","sankey-tooltip").style("opacity",0),p=_color.CategoricalColorNamespace.getScale(i),q=(0,_d3Sankey.sankey)().nodeWidth(15).nodePadding(10).size([l,m]),r=q.link(),s={},t=f.map(function(a){var b=Object.assign({},a);return b.source=s[b.source]||(s[b.source]={name:b.source}),b.target=s[b.target]||(s[b.target]={name:b.target}),b.value=+b.value,b});s=_d.default.values(s),q.nodes(s).links(t).layout(32);var u=n.append("g").selectAll(".link").data(t).enter().append("path").attr("class","link").attr("d",r).style("stroke-width",function(a){return Math.max(1,a.dy)}).sort(function(c,a){return a.dy-c.dy}).on("mouseover",d).on("mouseout",e),v=n.append("g").selectAll(".node").data(s).enter().append("g").attr("class","node").attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).call(_d.default.behavior.drag().origin(function(a){return a}).on("dragstart",function(){this.parentNode.appendChild(this)}).on("drag",function(a){_d.default.select(this).attr("transform","translate("+a.x+","+(a.y=Math.max(0,Math.min(h-a.dy,_d.default.event.y)))+")"),q.relayout(),u.attr("d",r)})),w=5;v.append("rect").attr("height",function(a){return a.dy>w?a.dy:w}).attr("width",q.nodeWidth()).style("fill",function(a){var b=a.name||"N/A";return a.color=p(b.replace(/ .*/,"")),a.color}).style("stroke",function(a){return _d.default.rgb(a.color).darker(2)}).on("mouseover",d).on("mouseout",e),v.append("text").attr("x",-6).attr("y",function(a){return a.dy/2}).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text(function(a){return a.name}).filter(function(a){return a.x<l/2}).attr("x",6+q.nodeWidth()).attr("text-anchor","start")}Sankey.displayName="Sankey",Sankey.propTypes=propTypes;var _default=Sankey;exports.default=_default;