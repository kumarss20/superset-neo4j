"use strict";exports.__esModule=!0,exports.default=void 0;var _propTypes=_interopRequireDefault(require("prop-types")),_react=_interopRequireWildcard(require("react")),_lodash=require("lodash"),_xyChart=require("@data-ui/xy-chart"),_theme=require("@data-ui/theme"),_chartComposition=require("@superset-ui/chart-composition"),_reselect=require("reselect"),_Encoder=_interopRequireDefault(require("./Encoder")),_DefaultTooltipRenderer=_interopRequireDefault(require("./DefaultTooltipRenderer")),_createMarginSelector=_interopRequireWildcard(require("../utils/selectors/createMarginSelector")),_convertScaleToDataUIScaleShape=_interopRequireDefault(require("../utils/convertScaleToDataUIScaleShape")),_createXYChartLayoutWithTheme=_interopRequireDefault(require("../utils/createXYChartLayoutWithTheme")),_createEncoderSelector=_interopRequireDefault(require("../encodeable/createEncoderSelector")),_createRenderLegend=_interopRequireDefault(require("../components/legend/createRenderLegend"));function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};d.get||d.set?Object.defineProperty(b,c,d):b[c]=a[c]}return b.default=a,b}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _inheritsLoose(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.__proto__=b}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var defaultProps={className:"",margin:_createMarginSelector.DEFAULT_MARGIN,theme:_theme.chartTheme,TooltipRenderer:_DefaultTooltipRenderer.default},CIRCLE_STYLE={strokeWidth:1.5},LineChart=/*#__PURE__*/function(a){function b(b){var c;return c=a.call(this,b)||this,_defineProperty(_assertThisInitialized(c),"createEncoder",(0,_createEncoderSelector.default)(_Encoder.default)),_defineProperty(_assertThisInitialized(c),"createAllSeries",(0,_reselect.createSelector)(function(a){return a.encoder},function(a){return a.data},function(a,b){var c=a.channels,d=a.getGroupBys(),e=(0,_lodash.groupBy)(b,function(a){return d.map(function(b){return b+"="+a[b]}).join(",")}),f=(0,_lodash.values)(e).map(function(a){var b=a[0],e=d.map(function(a){return b[a]}).join(","),f={key:0===e.length?c.y.getTitle():e,fill:c.fill.encode(b,!1),stroke:c.stroke.encode(b,"#222"),strokeDasharray:c.strokeDasharray.encode(b,""),strokeWidth:c.strokeWidth.encode(b,1),values:[]};return f.values=a.map(function(a){return{x:c.x.get(a),y:c.y.get(a),data:a,parent:f}}).sort(function(c,a){var b=c.x instanceof Date?c.x.getTime():c.x,d=a.x instanceof Date?a.x.getTime():a.x;return b-d}),f});return f})),_defineProperty(_assertThisInitialized(c),"createMargin",(0,_createMarginSelector.default)()),c.renderChart=c.renderChart.bind(_assertThisInitialized(c)),c}_inheritsLoose(b,a);var c=b.prototype;return c.renderSeries=function renderSeries(a){var b=(0,_lodash.flatMap)(a.filter(function(a){var b=a.fill;return b}).map(function(a){var b=(0,_lodash.uniqueId)((0,_lodash.kebabCase)("gradient-"+a.key));return[_react.default.createElement(_xyChart.LinearGradient,{key:a.key+"-gradient",id:b,from:a.stroke,to:"#fff"}),_react.default.createElement(_xyChart.AreaSeries,{key:a.key+"-fill",seriesKey:a.key,data:a.values,interpolation:"linear",fill:"url(#"+b+")",stroke:a.stroke,strokeWidth:a.strokeWidth})]})),c=a.filter(function(a){var b=a.fill;return!b}).map(function(a){return _react.default.createElement(_xyChart.LineSeries,{key:a.key,seriesKey:a.key,interpolation:"linear",data:a.values,stroke:a.stroke,strokeDasharray:a.strokeDasharray,strokeWidth:a.strokeWidth})});return b.concat(c)},c.renderChart=function renderChart(a){var b=this,c=a.width,d=a.height,e=this.props,f=e.data,g=e.margin,h=e.theme,i=e.TooltipRenderer,j=this.createEncoder(this.props),k=j.channels;if("undefined"!=typeof k.x.scale){var n=k.x.getDomain(f);k.x.scale.setDomain(n)}if("undefined"!=typeof k.y.scale){var o=k.y.getDomain(f);k.y.scale.setDomain(o)}var l=this.createAllSeries({encoder:j,data:f}),m=(0,_createXYChartLayoutWithTheme.default)({width:c,height:d,margin:this.createMargin(g),theme:h,xEncoder:k.x,yEncoder:k.y});return m.renderChartWithFrame(function(a){return _react.default.createElement(_xyChart.WithTooltip,{renderTooltip:function renderTooltip(a){var b=a.datum,c=a.series;return _react.default.createElement(i,{encoder:j,allSeries:l,datum:b,series:c,theme:h})}},function(c){var d=c.onMouseLeave,e=c.onMouseMove,f=c.tooltipData;return _react.default.createElement(_xyChart.XYChart,{width:a.width,height:a.height,ariaLabel:"LineChart",eventTrigger:"container",margin:m.margin,onMouseMove:e,onMouseLeave:d,renderTooltip:null,showYGrid:!0,snapTooltipToDataX:!0,theme:h,tooltipData:f,xScale:(0,_convertScaleToDataUIScaleShape.default)(k.x.scale.config),yScale:(0,_convertScaleToDataUIScaleShape.default)(k.y.scale.config)},m.renderXAxis(),m.renderYAxis(),b.renderSeries(l),_react.default.createElement(_xyChart.CrossHair,{fullHeight:!0,strokeDasharray:"",showHorizontalLine:!1,circleFill:function circleFill(a){return a.y===f.datum.y?a.parent.stroke:"#fff"},circleSize:function circleSize(a){return a.y===f.datum.y?6:4},circleStroke:function circleStroke(a){return a.y===f.datum.y?"#fff":a.parent.stroke},circleStyles:CIRCLE_STYLE,stroke:"#ccc",showCircle:!0,showMultipleCircles:!0}))})})},c.render=function render(){var a=this.props,b=a.className,c=a.data,d=a.width,e=a.height,f=this.createEncoder(this.props);return _react.default.createElement(_chartComposition.WithLegend,{className:"superset-chart-line "+b,width:d,height:e,position:"top",renderLegend:(0,_createRenderLegend.default)(f,c,this.props),renderChart:this.renderChart})},b}(_react.PureComponent);/** Part of formData that is needed for rendering logic in this file */exports.default=LineChart,_defineProperty(LineChart,"propTypes",{className:_propTypes.default.string,width:_propTypes.default.oneOfType([_propTypes.default.string,_propTypes.default.number]).isRequired,height:_propTypes.default.oneOfType([_propTypes.default.string,_propTypes.default.number]).isRequired,data:_propTypes.default.any.isRequired,TooltipRenderer:_propTypes.default.func,margin:_propTypes.default.any}),_defineProperty(LineChart,"defaultProps",defaultProps);