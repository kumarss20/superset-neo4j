"use strict";exports.__esModule=!0,exports.default=void 0;var _d3Array=require("d3-array"),_extractFormat=require("./parsers/extractFormat"),_extractScale=_interopRequireDefault(require("./parsers/extractScale")),_extractGetter=_interopRequireDefault(require("./parsers/extractGetter")),_ChannelDef=require("./types/ChannelDef"),_isEnabled=_interopRequireDefault(require("./utils/isEnabled")),_isDisabled=_interopRequireDefault(require("./utils/isDisabled")),_identity=_interopRequireDefault(require("./utils/identity")),_AxisAgent=_interopRequireDefault(require("./AxisAgent"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var ChannelEncoder=/*#__PURE__*/function(){function a(a){var b=a.name,c=a.type,d=a.definition,e=a.options,f=void 0===e?{}:e;_defineProperty(this,"name",void 0),_defineProperty(this,"type",void 0),_defineProperty(this,"definition",void 0),_defineProperty(this,"options",void 0),_defineProperty(this,"getValue",void 0),_defineProperty(this,"encodeValue",void 0),_defineProperty(this,"formatValue",void 0),_defineProperty(this,"scale",void 0),_defineProperty(this,"axis",void 0),this.name=b,this.type=c,this.definition=d,this.options=f,this.getValue=(0,_extractGetter.default)(d),this.formatValue=(0,_extractFormat.extractFormatFromChannelDef)(d),this.scale=(0,_extractScale.default)(this.type,d,f.namespace),this.isXY()&&(0,_ChannelDef.isNonValueDef)(this.definition)&&("axis"in this.definition&&(0,_isEnabled.default)(this.definition.axis)||!("axis"in this.definition))&&(this.axis=new _AxisAgent.default(this)),this.encodeValue=this.scale?this.scale.encodeValue:_identity.default,this.encode=this.encode.bind(this),this.format=this.format.bind(this),this.get=this.get.bind(this)}var b=a.prototype;return b.encode=// eslint-disable-next-line no-dupe-class-members
function encode(a,b){var c=this.get(a);if(null===c||void 0===c)return b;var d=this.encodeValue(c);return void 0!==b&&(null===d||void 0===d)?b:d},b.format=function format(a){return this.formatValue(this.get(a))},b.get=function get(a,b){var c=this.getValue(a);return void 0!==b&&(null===c||void 0===c)?b:c},b.getDomain=function getDomain(a){var b=this;if((0,_ChannelDef.isTypedFieldDef)(this.definition)){var c=this.definition.type;if("nominal"===c||"ordinal"===c)return Array.from(new Set(a.map(function(a){return b.get(a)})));if("quantitative"===c){var d=(0,_d3Array.extent)(a,function(a){return b.get(a)});return"undefined"==typeof d[0]?[0,1]:d}if("temporal"===c){var e=(0,_d3Array.extent)(a,function(a){return b.get(a)});return"undefined"==typeof e[0]?[0,1]:e}}return[]},b.getTitle=function getTitle(){return(0,_ChannelDef.isFieldDef)(this.definition)?this.definition.title||this.definition.field:""},b.hasLegend=function hasLegend(){return!((0,_isDisabled.default)(this.options.legend)||this.isXY()||(0,_ChannelDef.isValueDef)(this.definition))&&((0,_ChannelDef.isMarkPropFieldDef)(this.definition)?(0,_isEnabled.default)(this.definition.legend):(0,_ChannelDef.isScaleFieldDef)(this.definition))},b.isGroupBy=function isGroupBy(){if((0,_ChannelDef.isTypedFieldDef)(this.definition)){var a=this.definition.type;return"Category"===this.type||"Text"===this.type||"Color"===this.type&&("nominal"===a||"ordinal"===a)||this.isXY()&&("nominal"===a||"ordinal"===a)}return!1},b.isX=function isX(){return"X"===this.type||"XBand"===this.type},b.isXY=function isXY(){return"X"===this.type||"Y"===this.type||"XBand"===this.type||"YBand"===this.type},b.isY=function isY(){return"Y"===this.type||"YBand"===this.type},a}();exports.default=ChannelEncoder;