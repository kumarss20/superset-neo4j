import _pt from"prop-types";function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _inheritsLoose(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.__proto__=b}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}/* eslint-disable sort-keys, no-magic-numbers, complexity */import React,{PureComponent}from"react";import{kebabCase,groupBy,flatMap,uniqueId,values}from"lodash";import{AreaSeries,LinearGradient,LineSeries,XYChart,CrossHair,WithTooltip}from"@data-ui/xy-chart";import{chartTheme}from"@data-ui/theme";import{WithLegend}from"@superset-ui/chart-composition";import{createSelector}from"reselect";import Encoder from"./Encoder";import DefaultTooltipRenderer from"./DefaultTooltipRenderer";import createMarginSelector,{DEFAULT_MARGIN}from"../utils/selectors/createMarginSelector";import convertScaleToDataUIScale from"../utils/convertScaleToDataUIScaleShape";import createXYChartLayoutWithTheme from"../utils/createXYChartLayoutWithTheme";import createEncoderSelector from"../encodeable/createEncoderSelector";import createRenderLegend from"../components/legend/createRenderLegend";var defaultProps={className:"",margin:DEFAULT_MARGIN,theme:chartTheme,TooltipRenderer:DefaultTooltipRenderer},CIRCLE_STYLE={strokeWidth:1.5},LineChart=/*#__PURE__*/function(a){function b(b){var c;return c=a.call(this,b)||this,_defineProperty(_assertThisInitialized(c),"createEncoder",createEncoderSelector(Encoder)),_defineProperty(_assertThisInitialized(c),"createAllSeries",createSelector(function(a){return a.encoder},function(a){return a.data},function(a,b){var c=a.channels,d=a.getGroupBys(),e=groupBy(b,function(a){return d.map(function(b){return b+"="+a[b]}).join(",")}),f=values(e).map(function(a){var b=a[0],e=d.map(function(a){return b[a]}).join(","),f={key:0===e.length?c.y.getTitle():e,fill:c.fill.encode(b,!1),stroke:c.stroke.encode(b,"#222"),strokeDasharray:c.strokeDasharray.encode(b,""),strokeWidth:c.strokeWidth.encode(b,1),values:[]};return f.values=a.map(function(a){return{x:c.x.get(a),y:c.y.get(a),data:a,parent:f}}).sort(function(c,a){var b=c.x instanceof Date?c.x.getTime():c.x,d=a.x instanceof Date?a.x.getTime():a.x;return b-d}),f});return f})),_defineProperty(_assertThisInitialized(c),"createMargin",createMarginSelector()),c.renderChart=c.renderChart.bind(_assertThisInitialized(c)),c}_inheritsLoose(b,a);var c=b.prototype;return c.renderSeries=function renderSeries(a){var b=flatMap(a.filter(function(a){var b=a.fill;return b}).map(function(a){var b=uniqueId(kebabCase("gradient-"+a.key));return[React.createElement(LinearGradient,{key:a.key+"-gradient",id:b,from:a.stroke,to:"#fff"}),React.createElement(AreaSeries,{key:a.key+"-fill",seriesKey:a.key,data:a.values,interpolation:"linear",fill:"url(#"+b+")",stroke:a.stroke,strokeWidth:a.strokeWidth})]})),c=a.filter(function(a){var b=a.fill;return!b}).map(function(a){return React.createElement(LineSeries,{key:a.key,seriesKey:a.key,interpolation:"linear",data:a.values,stroke:a.stroke,strokeDasharray:a.strokeDasharray,strokeWidth:a.strokeWidth})});return b.concat(c)},c.renderChart=function renderChart(a){var b=this,c=a.width,d=a.height,e=this.props,f=e.data,g=e.margin,h=e.theme,i=e.TooltipRenderer,j=this.createEncoder(this.props),k=j.channels;if("undefined"!=typeof k.x.scale){var n=k.x.getDomain(f);k.x.scale.setDomain(n)}if("undefined"!=typeof k.y.scale){var o=k.y.getDomain(f);k.y.scale.setDomain(o)}var l=this.createAllSeries({encoder:j,data:f}),m=createXYChartLayoutWithTheme({width:c,height:d,margin:this.createMargin(g),theme:h,xEncoder:k.x,yEncoder:k.y});return m.renderChartWithFrame(function(a){return React.createElement(WithTooltip,{renderTooltip:function renderTooltip(a){var b=a.datum,c=a.series;return React.createElement(i,{encoder:j,allSeries:l,datum:b,series:c,theme:h})}},function(c){var d=c.onMouseLeave,e=c.onMouseMove,f=c.tooltipData;return React.createElement(XYChart,{width:a.width,height:a.height,ariaLabel:"LineChart",eventTrigger:"container",margin:m.margin,onMouseMove:e,onMouseLeave:d,renderTooltip:null,showYGrid:!0,snapTooltipToDataX:!0,theme:h,tooltipData:f,xScale:convertScaleToDataUIScale(k.x.scale.config),yScale:convertScaleToDataUIScale(k.y.scale.config)},m.renderXAxis(),m.renderYAxis(),b.renderSeries(l),React.createElement(CrossHair,{fullHeight:!0,strokeDasharray:"",showHorizontalLine:!1,circleFill:function circleFill(a){return a.y===f.datum.y?a.parent.stroke:"#fff"},circleSize:function circleSize(a){return a.y===f.datum.y?6:4},circleStroke:function circleStroke(a){return a.y===f.datum.y?"#fff":a.parent.stroke},circleStyles:CIRCLE_STYLE,stroke:"#ccc",showCircle:!0,showMultipleCircles:!0}))})})},c.render=function render(){var a=this.props,b=a.className,c=a.data,d=a.width,e=a.height,f=this.createEncoder(this.props);return React.createElement(WithLegend,{className:"superset-chart-line "+b,width:d,height:e,position:"top",renderLegend:createRenderLegend(f,c,this.props),renderChart:this.renderChart})},b}(PureComponent);/** Part of formData that is needed for rendering logic in this file */_defineProperty(LineChart,"propTypes",{className:_pt.string,width:_pt.oneOfType([_pt.string,_pt.number]).isRequired,height:_pt.oneOfType([_pt.string,_pt.number]).isRequired,data:_pt.any.isRequired,TooltipRenderer:_pt.func,margin:_pt.any}),_defineProperty(LineChart,"defaultProps",defaultProps);export{LineChart as default};