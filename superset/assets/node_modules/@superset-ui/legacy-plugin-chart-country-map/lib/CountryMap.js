"use strict";exports.__esModule=!0,exports.default=void 0;var _d=_interopRequireDefault(require("d3")),_propTypes=_interopRequireDefault(require("prop-types")),_d3Array=require("d3-array"),_color=require("@superset-ui/color"),_numberFormat=require("@superset-ui/number-format"),_countries=_interopRequireDefault(require("./countries"));require("./CountryMap.css");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}/**
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */ /* eslint-disable sort-keys, babel/no-invalid-this, no-magic-numbers */var propTypes={data:_propTypes.default.arrayOf(_propTypes.default.shape({country_id:_propTypes.default.string,metric:_propTypes.default.number})),width:_propTypes.default.number,height:_propTypes.default.number,country:_propTypes.default.string,linearColorScheme:_propTypes.default.string,mapBaseUrl:_propTypes.default.string,numberFormat:_propTypes.default.string},maps={};function CountryMap(a,b){function c(a){var b=a.features,c=_d.default.geo.centroid(a),e=100,g=_d.default.geo.mercator().scale(e).center(c).translate([f/2,h/2]);q.projection(g);// Compute scale that fits container.
var i=q.bounds(a),j=e*f/(i[1][0]-i[0][0]),k=e*h/(i[1][1]-i[0][1]),l=j<k?j:k;g.scale(l);var m=q.bounds(a);// Draw each province as a path
g.translate([f-(m[0][0]+m[1][0])/2,h-(m[0][1]+m[1][1])/2]),d.selectAll("path").data(b).enter().append("path").attr("d",q).attr("class","region").attr("vector-effect","non-scaling-stroke").style("fill",p).on("mouseenter",D).on("mouseout",E).on("click",A)}var e=b.data,f=b.width,h=b.height,i=b.country,j=b.linearColorScheme,k=b.numberFormat,l=a,m=(0,_numberFormat.getNumberFormatter)(k),n=(0,_color.getSequentialSchemeRegistry)().get(j).createLinearScale((0,_d3Array.extent)(e,function(a){return a.metric})),o={};e.forEach(function(a){o[a.country_id]=n(a.metric)});var p=function(a){return o[a.properties.ISO]||"none"},q=_d.default.geo.path(),r=_d.default.select(l);r.classed("superset-legacy-chart-country-map",!0),r.selectAll("*").remove(),l.style.height=h+"px",l.style.width=f+"px";var s,t=r.append("svg:svg").attr("width",f).attr("height",h).attr("preserveAspectRatio","xMidYMid meet"),u=t.append("rect").attr("class","background").attr("width",f).attr("height",h),v=t.append("g"),d=v.append("g").classed("map-layer",!0),g=v.append("g").classed("text-layer",!0).attr("transform","translate("+f/2+", 45)"),w=g.append("text").classed("big-text",!0),z=g.append("text").classed("result-text",!0).attr("dy","1em"),A=function(a){var b,c,d,e=a&&s!==a,i=f/2,j=h/2;if(e){var l=q.centroid(a);b=l[0],c=l[1],d=4,s=a}else b=i,c=j,d=1,s=null;v.transition().duration(750).attr("transform","translate("+i+","+j+")scale("+d+")translate("+-b+","+-c+")"),g.style("opacity",0).attr("transform","translate(0,0)translate("+b+","+(e?c-5:45)+")").transition().duration(750).style("opacity",1),w.transition().duration(750).style("font-size",e?6:16),z.transition().duration(750).style("font-size",e?16:24)};u.on("click",A);var B=function(a){var b="";a&&a.properties&&(a.properties.ID_2?b=a.properties.NAME_2:b=a.properties.NAME_1),w.text(b)},C=function(a){0<a.length&&z.text(m(a[0].metric))},D=function(a){// Darken color
var b=p(a);"none"!==b&&(b=_d.default.rgb(b).darker().toString()),_d.default.select(this).style("fill",b),B(a);var d=e.filter(function(b){return b.country_id===a.properties.ISO});C(d)},E=function(){_d.default.select(this).style("fill",p),w.text(""),z.text("")},F=i.toLowerCase(),G=maps[F];if(G)c(G);else{var H=_countries.default[F];_d.default.json(H,function(a,b){a||(maps[F]=b,c(b))})}}CountryMap.displayName="CountryMap",CountryMap.propTypes=propTypes;var _default=CountryMap;exports.default=_default;