"use strict";exports.__esModule=!0,exports.getBreakPoints=getBreakPoints,exports.getBreakPointColorScaler=getBreakPointColorScaler,exports.getBuckets=getBuckets;var _d3Array=require("d3-array"),_d3Scale=require("d3-scale"),_color=require("@superset-ui/color"),_colors=require("./utils/colors"),DEFAULT_NUM_BUCKETS=10;function getBreakPoints(a,b,c){var d=a.break_points,e=a.num_buckets;if(!b)return[];if(void 0===d||0===d.length){// compute evenly distributed break points based on number of buckets
var f=e?parseInt(e,10):DEFAULT_NUM_BUCKETS,g=(0,_d3Array.extent)(b,c),h=g[0],i=g[1];if(void 0===h)return[];var j=(i-h)/f,k=0===j?0:Math.max(0,Math.ceil(Math.log10(1/j))),l=i>i.toFixed(k)?1:0;return Array(f+1+l).fill().map(function(a,b){return(h+b*j).toFixed(k)})}return d.sort(function(c,a){return parseFloat(c)-parseFloat(a)})}function getBreakPointColorScaler(a,b,e){var f,g,h=a.break_points,i=a.num_buckets,j=a.linear_color_scheme,k=a.opacity,l=h||i?getBreakPoints({break_points:h,num_buckets:i},b,e):null,m=Array.isArray(j)?new _color.SequentialScheme({colors:j,id:"custom"}):(0,_color.getSequentialSchemeRegistry)().get(j);if(null!==l){// bucket colors into discrete colors
var o=l.length-1,c=1<o?m.getColors(o):[m.colors[m.colors.length-1]],d=c[0],n=c[c.length-1];c.unshift(d),c.push(n);var p=l.map(function(a){return parseFloat(a)});f=(0,_d3Scale.scaleThreshold)().domain(p).range(c),g=function(a){return a>l[o]||a<l[0]}}else// interpolate colors linearly
f=m.createLinearScale((0,_d3Array.extent)(b,e)),g=function(){return!1};return function(a){var b=e(a),d=(0,_colors.hexToRGB)(f(b));return d[3]=g(b)?0:255*(k/100),d}}function getBuckets(a,b,c){var d=getBreakPoints(a,b,c),e=getBreakPointColorScaler(a,b,c),f={};return d.slice(1).forEach(function(b,c){var g,h=d[c]+" - "+d[c+1],i=.5*(parseFloat(d[c])+parseFloat(d[c+1])),j=a.metric?a.metric.label||a.metric:null;f[h]={color:e((g={},g[j||a.metric]=i,g)),enabled:!0}}),f}