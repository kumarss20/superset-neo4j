"use strict";exports.__esModule=!0,exports.default=void 0;var _react=_interopRequireDefault(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_mousetrap=_interopRequireDefault(require("mousetrap")),_translation=require("@superset-ui/translation"),_BootstrapSliderWrapper=_interopRequireDefault(require("./BootstrapSliderWrapper"));require("./PlaySlider.css");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _inheritsLoose(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.__proto__=b}var propTypes={start:_propTypes.default.number.isRequired,step:_propTypes.default.number.isRequired,end:_propTypes.default.number.isRequired,values:_propTypes.default.array.isRequired,onChange:_propTypes.default.func,loopDuration:_propTypes.default.number,maxFrames:_propTypes.default.number,orientation:_propTypes.default.oneOf(["horizontal","vertical"]),reversed:_propTypes.default.bool,disabled:_propTypes.default.bool,range:_propTypes.default.bool},defaultProps={onChange:function onChange(){},loopDuration:15e3,maxFrames:100,orientation:"horizontal",reversed:!1,disabled:!1,range:!0},PlaySlider=/*#__PURE__*/function(a){function b(b){var c;c=a.call(this,b)||this,c.state={intervalId:null};var d=b.end-b.start,e=Math.min(b.maxFrames,d/b.step),f=d/e;return c.intervalMilliseconds=b.loopDuration/e,c.increment=f<b.step?b.step:f-f%b.step,c.onChange=c.onChange.bind(_assertThisInitialized(c)),c.play=c.play.bind(_assertThisInitialized(c)),c.pause=c.pause.bind(_assertThisInitialized(c)),c.stepBackward=c.stepBackward.bind(_assertThisInitialized(c)),c.stepForward=c.stepForward.bind(_assertThisInitialized(c)),c.getPlayClass=c.getPlayClass.bind(_assertThisInitialized(c)),c.formatter=c.formatter.bind(_assertThisInitialized(c)),c}_inheritsLoose(b,a);var c=b.prototype;return c.componentDidMount=function componentDidMount(){_mousetrap.default.bind(["space"],this.play)},c.componentWillUnmount=function componentWillUnmount(){_mousetrap.default.unbind(["space"])},c.onChange=function onChange(a){this.props.onChange(a.target.value),null!=this.state.intervalId&&this.pause()},c.getPlayClass=function getPlayClass(){return null==this.state.intervalId?"fa fa-play fa-lg slider-button":"fa fa-pause fa-lg slider-button"},c.play=function play(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{var a=setInterval(this.stepForward,this.intervalMilliseconds);this.setState({intervalId:a})}},c.pause=function pause(){clearInterval(this.state.intervalId),this.setState({intervalId:null})},c.stepForward=function stepForward(){var a=this,b=this.props,c=b.start,d=b.end,e=b.step,f=b.values,g=b.disabled;if(!g){var h=Array.isArray(f)?f:[f,f+e],i=h.map(function(b){return b+a.increment}),j=i[1]>d?i[0]-c:0;this.props.onChange(i.map(function(a){return a-j}))}},c.stepBackward=function stepBackward(){var a=this,b=this.props,c=b.start,d=b.end,e=b.step,f=b.values,g=b.disabled;if(!g){var h=Array.isArray(f)?f:[f,f+e],i=h.map(function(b){return b-a.increment}),j=i[0]<c?d-i[1]:0;this.props.onChange(i.map(function(a){return a+j}))}},c.formatter=function formatter(a){if(this.props.disabled)return(0,_translation.t)("Data has no time steps");var b=a;return Array.isArray(a)?a[0]===a[1]&&(b=[a[0]]):b=[a],b.map(function(a){return new Date(a).toUTCString()}).join(" : ")},c.render=function render(){var a=this.props,b=a.start,c=a.end,d=a.step,e=a.orientation,f=a.reversed,g=a.disabled,h=a.range,i=a.values;return _react.default.createElement("div",{className:"play-slider"},_react.default.createElement("div",{className:"play-slider-controls padded"},_react.default.createElement("i",{className:"fa fa-step-backward fa-lg slider-button ",onClick:this.stepBackward}),_react.default.createElement("i",{className:this.getPlayClass(),onClick:this.play}),_react.default.createElement("i",{className:"fa fa-step-forward fa-lg slider-button ",onClick:this.stepForward})),_react.default.createElement("div",{className:"play-slider-scrobbler padded"},_react.default.createElement(_BootstrapSliderWrapper.default,{value:h?i:i[0],range:h,formatter:this.formatter,change:this.onChange,min:b,max:c,step:d,orientation:e,reversed:f,disabled:g?"disabled":"enabled"})))},b}(_react.default.PureComponent);exports.default=PlaySlider,PlaySlider.propTypes=propTypes,PlaySlider.defaultProps=defaultProps;