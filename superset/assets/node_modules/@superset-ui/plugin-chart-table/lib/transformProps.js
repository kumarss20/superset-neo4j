"use strict";exports.__esModule=!0,exports.default=transformProps;var _processColumns=_interopRequireDefault(require("./processColumns")),_processMetrics=_interopRequireDefault(require("./processMetrics")),_processData=_interopRequireDefault(require("./processData"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _extends(){return _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}var processColumns=(0,_processColumns.default)(),processMetrics=(0,_processMetrics.default)(),processData=(0,_processData.default)(),DTTM_ALIAS="__timestamp";function transformData(a,b){var c=b.groupby,d=void 0===c?[]:c,e=b.metrics,f=void 0===e?[]:e,g=b.allColumns,h=void 0===g?[]:g,i=new Set([].concat(d,f,h).map(function(a){return a.label||a})),j=a;b.includeTime&&i.add(DTTM_ALIAS);// handle percentage columns.
var k=(b.percentMetrics||[]).map(function(a){return a.label||a});if(0<k.length){var l=a.reduce(function(a,b){var c=_extends({},a);return k.forEach(function(d){c[d]=(a[d]||0)+(b[d]||0)}),c},{});j=a.map(function(a){var b=_extends({},a);return k.forEach(function(a){b["%"+a]=0===l[a]?null:b[a]/l[a]}),b}),k.forEach(function(a){i.add("%"+a)})}// handle sortedby column
if(b.timeseriesLimitMetric){var m=b.timeseriesLimitMetric.label||b.timeseriesLimitMetric;i.add(m)}return{columns:[].concat(i),records:j}}var NOOP=function(){};function transformProps(a){var b=a.height,c=a.width,d=a.datasource,e=a.initialValues,f=a.formData,g=a.hooks,h=a.queryData,i=g.onAddFilter,j=void 0===i?NOOP:i,k=f.alignPn,l=f.colorPn,m=f.includeSearch,n=f.metrics,o=f.orderDesc,p=f.pageLength,q=f.percentMetrics,r=f.tableFilter,s=f.tableTimestampFormat,t=f.timeseriesLimitMetric,u=transformData(h.data,f),v=u.records,w=u.columns,x=processMetrics({metrics:n,percentMetrics:q,records:v}),y=processData({metrics:x,orderDesc:o,records:v,timeseriesLimitMetric:t}),z=processColumns({columns:w,datasource:d,metrics:x,records:v,tableTimestampFormat:s});return{alignPositiveNegative:k,colorPositiveNegative:l,columns:z,data:y,filters:e,height:b,includeSearch:m,onAddFilter:j,orderDesc:o,pageLength:p&&parseInt(p,10),tableFilter:r,width:c}}