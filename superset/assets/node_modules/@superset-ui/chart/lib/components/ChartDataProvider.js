"use strict";exports.__esModule=!0,exports.default=void 0;var _propTypes=_interopRequireDefault(require("prop-types")),_react=_interopRequireDefault(require("react")),_ChartClient=_interopRequireDefault(require("../clients/ChartClient"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _inheritsLoose(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.__proto__=b}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var ChartDataProvider=/*#__PURE__*/function(a){function b(b){var c;return c=a.call(this,b)||this,_defineProperty(_assertThisInitialized(c),"chartClient",void 0),c.handleFetchData=c.handleFetchData.bind(_assertThisInitialized(c)),c.handleReceiveData=c.handleReceiveData.bind(_assertThisInitialized(c)),c.handleError=c.handleError.bind(_assertThisInitialized(c)),c.chartClient=new _ChartClient.default({client:b.client}),c.state={status:"uninitialized"},c}_inheritsLoose(b,a);var c=b.prototype;return c.componentDidMount=function componentDidMount(){this.handleFetchData()},c.componentDidUpdate=function componentDidUpdate(a){var b=this.props,c=b.formData,d=b.sliceId;(c!==a.formData||d!==a.sliceId)&&this.handleFetchData()},c.extractSliceIdAndFormData=function extractSliceIdAndFormData(){var a=this.props,b=a.formData,c=a.sliceId,d={};return b&&(d.formData=b),c&&(d.sliceId=c),d},c.handleFetchData=function handleFetchData(){var a=this,b=this.props,c=b.loadDatasource,d=b.formDataRequestOptions,e=b.datasourceRequestOptions,f=b.queryRequestOptions;this.setState({status:"loading"},function(){try{a.chartClient.loadFormData(a.extractSliceIdAndFormData(),d).then(function(b){return Promise.all([c?a.chartClient.loadDatasource(b.datasource,e):Promise.resolve(void 0),a.chartClient.loadQueryData(b,f)]).then(function(a){var c=a[0],d=a[1];return{datasource:c,formData:b,queryData:d}})}).then(a.handleReceiveData).catch(a.handleError)}catch(b){a.handleError(b)}})},c.handleReceiveData=function handleReceiveData(a){var b=this.props.onLoaded;b&&b(a),this.setState({payload:a,status:"loaded"})},c.handleError=function handleError(a){var b=this.props.onError;b&&b(a),this.setState({error:a,status:"error"})},c.render=function render(){var a=this.props.children,b=this.state,c=b.status,d=b.payload,e=b.error;switch(c){case"loading":return a({loading:!0});case"loaded":return a({payload:d});case"error":return a({error:e});case"uninitialized":default:return null;}},b}(_react.default.PureComponent);_defineProperty(ChartDataProvider,"propTypes",{children:_propTypes.default.func.isRequired,client:_propTypes.default.any,loadDatasource:_propTypes.default.bool,onError:_propTypes.default.func,onLoaded:_propTypes.default.func,formDataRequestOptions:_propTypes.default.any,datasourceRequestOptions:_propTypes.default.any,queryRequestOptions:_propTypes.default.any});var _default=ChartDataProvider;exports.default=_default;