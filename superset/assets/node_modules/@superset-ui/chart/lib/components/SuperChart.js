"use strict";exports.__esModule=!0,exports.default=void 0;var _propTypes=_interopRequireDefault(require("prop-types")),_react=_interopRequireDefault(require("react")),_reactErrorBoundary=_interopRequireDefault(require("react-error-boundary")),_dimension=require("@superset-ui/dimension"),_responsive=require("@vx/responsive"),_reselect=require("reselect"),_SuperChartCore=_interopRequireDefault(require("./SuperChartCore")),_FallbackComponent2=_interopRequireDefault(require("./FallbackComponent")),_ChartProps=_interopRequireDefault(require("../models/ChartProps"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _extends(){return _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}function _objectWithoutPropertiesLoose(a,b){if(null==a)return{};var c,d,e={},f=Object.keys(a);for(d=0;d<f.length;d++)c=f[d],0<=b.indexOf(c)||(e[c]=a[c]);return e}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _inheritsLoose(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.__proto__=b}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var defaultProps={FallbackComponent:_FallbackComponent2.default,// eslint-disable-next-line no-magic-numbers
height:400,width:"100%"},SuperChart=/*#__PURE__*/function(a){function b(){for(var b,c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];return b=a.call.apply(a,[this].concat(d))||this,_defineProperty(_assertThisInitialized(b),"core",void 0),_defineProperty(_assertThisInitialized(b),"createChartProps",_ChartProps.default.createSelector()),_defineProperty(_assertThisInitialized(b),"parseDimension",(0,_reselect.createSelector)(function(a){var b=a.width;return b},function(a){var b=a.height;return b},function(a,b){// Parse them in case they are % or 'auto'
var c=(0,_dimension.parseLength)(a),d=(0,_dimension.parseLength)(b),e=d.isDynamic?// eslint-disable-next-line no-magic-numbers
100*d.multiplier+"%":d.value,f=c.isDynamic?// eslint-disable-next-line no-magic-numbers
100*c.multiplier+"%":c.value,g={height:e,width:f},h=c.isDynamic&&d.isDynamic&&1===c.multiplier&&1===d.multiplier?_react.default.Fragment:function(a){var b=a.children;return _react.default.createElement("div",{style:g},b)};return{BoundingBox:h,heightInfo:d,widthInfo:c}})),_defineProperty(_assertThisInitialized(b),"setRef",function(a){b.core=a}),b}_inheritsLoose(b,a);var c=b.prototype;return c.renderChart=function renderChart(a,b){var c=this.props,d=c.id,e=c.className,f=c.chartType,g=c.preTransformProps,h=c.overrideTransformProps,i=c.postTransformProps,j=c.onRenderSuccess,k=c.onRenderFailure,l=c.disableErrorBoundary,m=c.FallbackComponent,n=c.onErrorBoundary,o=c.Wrapper,p=_objectWithoutPropertiesLoose(c,["id","className","chartType","preTransformProps","overrideTransformProps","postTransformProps","onRenderSuccess","onRenderFailure","disableErrorBoundary","FallbackComponent","onErrorBoundary","Wrapper"]),q=_react.default.createElement(_SuperChartCore.default,{ref:this.setRef,id:d,className:e,chartType:f,chartProps:this.createChartProps(_extends({},p,{height:b,width:a})),preTransformProps:g,overrideTransformProps:h,postTransformProps:i,onRenderSuccess:j,onRenderFailure:k}),r=o?_react.default.createElement(o,{width:a,height:b},q):q;// Include the error boundary by default unless it is specifically disabled.
return!0===l?r:_react.default.createElement(_reactErrorBoundary.default,{FallbackComponent:function FallbackComponent(c){return _react.default.createElement(m,_extends({width:a,height:b},c))},onError:n},r)},c.render=function render(){var a=this,b=this.parseDimension(this.props),c=b.heightInfo,d=b.widthInfo,e=b.BoundingBox;// If any of the dimension is dynamic, get parent's dimension
if(d.isDynamic||c.isDynamic){var f=this.props.debounceTime;return _react.default.createElement(e,null,_react.default.createElement(_responsive.ParentSize,{debounceTime:f},function(b){var e=b.width,f=b.height;return 0<e&&0<f&&a.renderChart(d.isDynamic?Math.floor(e):d.value,c.isDynamic?Math.floor(f):c.value)}))}return this.renderChart(d.value,c.value)},b}(_react.default.PureComponent);exports.default=SuperChart,_defineProperty(SuperChart,"propTypes",{disableErrorBoundary:_propTypes.default.bool,debounceTime:_propTypes.default.number,FallbackComponent:_propTypes.default.func,height:_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.string]),width:_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.string]),Wrapper:_propTypes.default.func}),_defineProperty(SuperChart,"defaultProps",defaultProps);