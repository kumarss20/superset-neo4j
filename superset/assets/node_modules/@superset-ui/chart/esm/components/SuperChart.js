import _pt from"prop-types";function _extends(){return _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}function _objectWithoutPropertiesLoose(a,b){if(null==a)return{};var c,d,e={},f=Object.keys(a);for(d=0;d<f.length;d++)c=f[d],0<=b.indexOf(c)||(e[c]=a[c]);return e}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _inheritsLoose(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.__proto__=b}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}import React from"react";import ErrorBoundary from"react-error-boundary";import{parseLength}from"@superset-ui/dimension";import{ParentSize}from"@vx/responsive";import{createSelector}from"reselect";import SuperChartCore from"./SuperChartCore";import DefaultFallbackComponent from"./FallbackComponent";import ChartProps from"../models/ChartProps";var defaultProps={FallbackComponent:DefaultFallbackComponent,// eslint-disable-next-line no-magic-numbers
height:400,width:"100%"},SuperChart=/*#__PURE__*/function(a){function b(){for(var b,c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];return b=a.call.apply(a,[this].concat(d))||this,_defineProperty(_assertThisInitialized(b),"core",void 0),_defineProperty(_assertThisInitialized(b),"createChartProps",ChartProps.createSelector()),_defineProperty(_assertThisInitialized(b),"parseDimension",createSelector(function(a){var b=a.width;return b},function(a){var b=a.height;return b},function(a,b){// Parse them in case they are % or 'auto'
var c=parseLength(a),d=parseLength(b),e=d.isDynamic?// eslint-disable-next-line no-magic-numbers
100*d.multiplier+"%":d.value,f=c.isDynamic?// eslint-disable-next-line no-magic-numbers
100*c.multiplier+"%":c.value,g={height:e,width:f},h=c.isDynamic&&d.isDynamic&&1===c.multiplier&&1===d.multiplier?React.Fragment:function(a){var b=a.children;return React.createElement("div",{style:g},b)};return{BoundingBox:h,heightInfo:d,widthInfo:c}})),_defineProperty(_assertThisInitialized(b),"setRef",function(a){b.core=a}),b}_inheritsLoose(b,a);var c=b.prototype;return c.renderChart=function renderChart(a,b){var c=this.props,d=c.id,e=c.className,f=c.chartType,g=c.preTransformProps,h=c.overrideTransformProps,i=c.postTransformProps,j=c.onRenderSuccess,k=c.onRenderFailure,l=c.disableErrorBoundary,m=c.FallbackComponent,n=c.onErrorBoundary,o=c.Wrapper,p=_objectWithoutPropertiesLoose(c,["id","className","chartType","preTransformProps","overrideTransformProps","postTransformProps","onRenderSuccess","onRenderFailure","disableErrorBoundary","FallbackComponent","onErrorBoundary","Wrapper"]),q=React.createElement(SuperChartCore,{ref:this.setRef,id:d,className:e,chartType:f,chartProps:this.createChartProps(_extends({},p,{height:b,width:a})),preTransformProps:g,overrideTransformProps:h,postTransformProps:i,onRenderSuccess:j,onRenderFailure:k}),r=o?React.createElement(o,{width:a,height:b},q):q;// Include the error boundary by default unless it is specifically disabled.
return!0===l?r:React.createElement(ErrorBoundary,{FallbackComponent:function FallbackComponent(c){return React.createElement(m,_extends({width:a,height:b},c))},onError:n},r)},c.render=function render(){var a=this,b=this.parseDimension(this.props),c=b.heightInfo,d=b.widthInfo,e=b.BoundingBox;// If any of the dimension is dynamic, get parent's dimension
if(d.isDynamic||c.isDynamic){var f=this.props.debounceTime;return React.createElement(e,null,React.createElement(ParentSize,{debounceTime:f},function(b){var e=b.width,f=b.height;return 0<e&&0<f&&a.renderChart(d.isDynamic?Math.floor(e):d.value,c.isDynamic?Math.floor(f):c.value)}))}return this.renderChart(d.value,c.value)},b}(React.PureComponent);_defineProperty(SuperChart,"propTypes",{disableErrorBoundary:_pt.bool,debounceTime:_pt.number,FallbackComponent:_pt.func,height:_pt.oneOfType([_pt.number,_pt.string]),width:_pt.oneOfType([_pt.number,_pt.string]),Wrapper:_pt.func}),_defineProperty(SuperChart,"defaultProps",defaultProps);export{SuperChart as default};