/**
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */ /* eslint-disable sort-keys, no-magic-numbers, react/forbid-prop-types */import PropTypes from"prop-types";import{extent as d3Extent,range as d3Range}from"d3-array";import{select as d3Select}from"d3-selection";import{getSequentialSchemeRegistry}from"@superset-ui/color";import{getNumberFormatter}from"@superset-ui/number-format";import{getTimeFormatter}from"@superset-ui/time-format";import CalHeatMap from"./vendor/cal-heatmap";import"./vendor/cal-heatmap.css";import"./Calendar.css";function convertUTC(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds())}var convertUTCTS=function(a){return convertUTC(new Date(a)).getTime()},propTypes={data:PropTypes.shape({// Object hashed by metric name,
// then hashed by timestamp (in seconds, not milliseconds) as float
// the innermost value is count
// e.g. { count_distinct_something: { 1535034236.0: 3 } }
data:PropTypes.object,domain:PropTypes.string,range:PropTypes.number,// timestamp in milliseconds
start:PropTypes.number,subdomain:PropTypes.string}),height:PropTypes.number,cellPadding:PropTypes.number,cellRadius:PropTypes.number,cellSize:PropTypes.number,linearColorScheme:PropTypes.string,showLegend:PropTypes.bool,showMetricName:PropTypes.bool,showValues:PropTypes.bool,steps:PropTypes.number,timeFormat:PropTypes.string,valueFormat:PropTypes.string,verboseMap:PropTypes.object};function Calendar(a,b){var c=b.data,d=b.height,e=b.cellPadding,f=void 0===e?3:e,g=b.cellRadius,h=void 0===g?0:g,i=b.cellSize,j=void 0===i?10:i,k=b.linearColorScheme,l=b.showLegend,m=b.showMetricName,n=b.showValues,o=b.steps,p=b.timeFormat,q=b.valueFormat,r=b.verboseMap,s=getNumberFormatter(q),t=getTimeFormatter(p),u=d3Select(a).classed("superset-legacy-chart-calendar",!0).style("height",d);u.selectAll("*").remove();var v=u.append("div"),w=n?function(a,b){return s(b)}:null,x={};Object.keys(c.data).forEach(function(a){x[a]={},Object.keys(c.data[a]).forEach(function(b){x[a][convertUTCTS(1e3*b)/1e3]=c.data[a][b]})}),Object.keys(x).forEach(function(a){var b=v.append("div");m&&b.text("Metric: "+(r[a]||a));var d=x[a],e=d3Extent(Object.keys(d),function(a){return d[a]}),g=(e[1]-e[0])/(o-1),i=getSequentialSchemeRegistry().get(k).createLinearScale(e),n=d3Range(o).map(function(a){return e[0]+g*a}),p=n.map(i),q=new CalHeatMap;q.init({start:convertUTCTS(c.start),data:d,itemSelector:b.node(),legendVerticalPosition:"top",cellSize:j,cellPadding:f,cellRadius:h,legendCellSize:j,legendCellPadding:2,legendCellRadius:h,tooltip:!0,domain:c.domain,subDomain:c.subdomain,range:c.range,browsing:!0,legend:n,legendColors:{colorScale:i,min:p[0],max:p[p.length-1],empty:"white"},displayLegend:l,itemName:"",valueFormatter:s,timeFormatter:t,subDomainTextFormat:w})})}Calendar.displayName="Calendar",Calendar.propTypes=propTypes;export default Calendar;