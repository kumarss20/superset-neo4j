/* eslint-disable no-param-reassign, sort-keys, no-magic-numbers */ /**
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */import d3 from"d3";import PropTypes from"prop-types";import{CategoricalColorNamespace}from"@superset-ui/color";import{getNumberFormatter}from"@superset-ui/number-format";import"./Chord.css";var propTypes={data:PropTypes.shape({matrix:PropTypes.arrayOf(PropTypes.arrayOf(PropTypes.number)),nodes:PropTypes.arrayOf(PropTypes.string)}),width:PropTypes.number,height:PropTypes.number,colorScheme:PropTypes.string,numberFormat:PropTypes.string};function Chord(a,b){var c=b.data,d=b.width,e=b.height,g=b.numberFormat,h=b.colorScheme;a.innerHTML="";var i=d3.select(a);i.classed("superset-legacy-chart-chord",!0);var j,k=c.nodes,l=c.matrix,m=getNumberFormatter(g),f=CategoricalColorNamespace.getScale(h),n=Math.min(d,e)/2-10,o=n-24,p=d3.svg.arc().innerRadius(o).outerRadius(n),q=d3.layout.chord().padding(.04).sortSubgroups(d3.descending).sortChords(d3.descending),r=d3.svg.chord().radius(o),s=i.append("svg").attr("width",d).attr("height",e).on("mouseout",function(){return j.classed("fade",!1)}).append("g").attr("id","circle").attr("transform","translate("+d/2+", "+e/2+")");s.append("circle").attr("r",n),q.matrix(l);var t=s.selectAll(".group").data(q.groups).enter().append("g").attr("class","group").on("mouseover",function(a,b){j.classed("fade",function(a){return a.source.index!==b&&a.target.index!==b})});// Add a mouseover title.
t.append("title").text(function(a,b){return k[b]+": "+m(a.value)});// Add the group arc.
var u=t.append("path").attr("id",function(a,b){return"group"+b}).attr("d",p).style("fill",function(a,b){return f(k[b])}),v=t.append("text").attr("x",6).attr("dy",15);// Add a text label.
// Remove the labels that don't fit. :(
// Add the chords.
// Add an elaborate mouseover title for each chord.
v.append("textPath").attr("xlink:href",function(a,b){return"#group"+b}).text(function(a,b){return k[b]}),v.filter(function(a,b){/* eslint-disable-next-line babel/no-invalid-this */return u[0][b].getTotalLength()/2-16<this.getComputedTextLength()}).remove(),j=s.selectAll(".chord").data(q.chords).enter().append("path").attr("class","chord").on("mouseover",function(a){j.classed("fade",function(b){return b!==a})}).style("fill",function(a){return f(k[a.source.index])}).attr("d",r),j.append("title").text(function(a){return k[a.source.index]+" \u2192 "+k[a.target.index]+": "+m(a.source.value)+"\n"+k[a.target.index]+" \u2192 "+k[a.source.index]+": "+m(a.target.value)})}Chord.displayName="Chord",Chord.propTypes=propTypes;export default Chord;