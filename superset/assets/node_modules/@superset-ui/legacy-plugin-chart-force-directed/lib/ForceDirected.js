"use strict";exports.__esModule=!0,exports.default=void 0;var _d=_interopRequireDefault(require("d3")),_propTypes=_interopRequireDefault(require("prop-types"));require("./ForceDirected.css");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}/**
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */ /* eslint-disable no-magic-numbers, sort-keys, func-names */ /* eslint-disable no-param-reassign, babel/no-invalid-this */var propTypes={data:_propTypes.default.arrayOf(_propTypes.default.shape({source:_propTypes.default.string,target:_propTypes.default.string,value:_propTypes.default.number})),width:_propTypes.default.number,height:_propTypes.default.number,linkLength:_propTypes.default.number,charge:_propTypes.default.number};/* Modified from http://bl.ocks.org/d3noob/5141278 */function ForceDirected(a,b){/* eslint-disable no-use-before-define */ // add the curvy lines
var c=b.data,d=b.width,e=b.height,f=b.linkLength,g=void 0===f?200:f,h=b.charge,i=void 0===h?-500:h,j=_d.default.select(a);j.classed("superset-legacy-chart-force-directed",!0);var k=c,l={};k.forEach(function(a){a.source=l[a.source]||(l[a.source]={name:a.source}),a.target=l[a.target]||(l[a.target]={name:a.target}),a.value=+a.value;var b=a.target.name,c=a.source.name;l[b].total===void 0&&(l[b].total=a.value),l[c].total===void 0&&(l[c].total=0),l[b].max===void 0&&(l[b].max=0),a.value>l[b].max&&(l[b].max=a.value),l[b].min===void 0&&(l[b].min=0),a.value>l[b].min&&(l[b].min=a.value),l[b].total+=a.value});/* eslint-enable no-use-before-define */var m=_d.default.layout.force().nodes(_d.default.values(l)).links(k).size([d,e]).linkDistance(g).charge(i).on("tick",function(){p.attr("d",function(a){var b=a.target.x-a.source.x,c=a.target.y-a.source.y,d=Math.sqrt(b*b+c*c);return"M"+a.source.x+","+a.source.y+"A"+d+","+d+" 0 0,1 "+a.target.x+","+a.target.y}),q.attr("transform",function(a){return"translate("+a.x+","+a.y+")"})}).start();j.selectAll("*").remove();var n=j.append("svg").attr("width",d).attr("height",e);// build the arrow.
n.append("svg:defs").selectAll("marker").data(["end"])// Different link/path types can be defined here
.enter().append("svg:marker")// This section adds in the arrows
.attr("id",String).attr("viewBox","0 -5 10 10").attr("refX",15).attr("refY",-1.5).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5");var o=_d.default.scale.linear().range([.1,.5]),p=n.append("svg:g").selectAll("path").data(m.links()).enter().append("svg:path").attr("class","link").style("opacity",function(a){return o(a.value/a.target.max)}).attr("marker-end","url(#end)"),q=n.selectAll(".node").data(m.nodes()).enter().append("g").attr("class","node").on("mouseenter",function(){_d.default.select(this).select("circle").transition().style("stroke-width",5),_d.default.select(this).select("text").transition().style("font-size",25)}).on("mouseleave",function(){_d.default.select(this).select("circle").transition().style("stroke-width",1.5),_d.default.select(this).select("text").transition().style("font-size",12)}).call(m.drag),r=_d.default.extent(_d.default.values(l),function(a){return Math.sqrt(a.total)}),s=_d.default.scale.linear().domain(r).range([3,30]);// add the links and the arrows
// add the text
q.append("circle").attr("r",function(a){return s(Math.sqrt(a.total))}),q.append("text").attr("x",6).attr("dy",".35em").text(function(a){return a.name})}ForceDirected.displayName="ForceDirected",ForceDirected.propTypes=propTypes;var _default=ForceDirected;exports.default=_default;