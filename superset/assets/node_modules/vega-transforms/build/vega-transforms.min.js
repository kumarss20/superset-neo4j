!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-util"),require("vega-dataflow"),require("vega-statistics"),require("d3-array")):"function"==typeof define&&define.amd?define(["exports","vega-util","vega-dataflow","vega-statistics","d3-array"],t):t(((e=e||self).vega=e.vega||{},e.vega.transforms={}),e.vega,e.vega,e.vega,e.d3)}(this,function(e,t,i,n,a){"use strict";function r(e){return e&&e.length?1===e.length?e[0]:(t=e,function(e){for(var i=t.length,n=1,a=String(t[0](e));n<i;++n)a+="|"+t[n](e);return a}):function(){return""};var t}function s(e,t,i){return i||e+(t?"_"+t:"")}var u={values:d({name:"values",init:"cell.store = true;",set:"cell.data.values()",idx:-1}),count:d({name:"count",set:"cell.num"}),__count__:d({name:"count",set:"this.missing + this.valid"}),missing:d({name:"missing",set:"this.missing"}),valid:d({name:"valid",set:"this.valid"}),sum:d({name:"sum",init:"this.sum = 0;",add:"this.sum += +v;",rem:"this.sum -= v;",set:"this.sum"}),mean:d({name:"mean",init:"this.mean = 0;",add:"var d = v - this.mean; this.mean += d / this.valid;",rem:"var d = v - this.mean; this.mean -= this.valid ? d / this.valid : this.mean;",set:"this.valid ? this.mean : undefined"}),average:d({name:"average",set:"this.valid ? this.mean : undefined",req:["mean"],idx:1}),variance:d({name:"variance",init:"this.dev = 0;",add:"this.dev += d * (v - this.mean);",rem:"this.dev -= d * (v - this.mean);",set:"this.valid > 1 ? this.dev / (this.valid-1) : undefined",req:["mean"],idx:1}),variancep:d({name:"variancep",set:"this.valid > 1 ? this.dev / this.valid : undefined",req:["variance"],idx:2}),stdev:d({name:"stdev",set:"this.valid > 1 ? Math.sqrt(this.dev / (this.valid-1)) : undefined",req:["variance"],idx:2}),stdevp:d({name:"stdevp",set:"this.valid > 1 ? Math.sqrt(this.dev / this.valid) : undefined",req:["variance"],idx:2}),stderr:d({name:"stderr",set:"this.valid > 1 ? Math.sqrt(this.dev / (this.valid * (this.valid-1))) : undefined",req:["variance"],idx:2}),distinct:d({name:"distinct",set:"cell.data.distinct(this.get)",req:["values"],idx:3}),ci0:d({name:"ci0",set:"cell.data.ci0(this.get)",req:["values"],idx:3}),ci1:d({name:"ci1",set:"cell.data.ci1(this.get)",req:["values"],idx:3}),median:d({name:"median",set:"cell.data.q2(this.get)",req:["values"],idx:3}),q1:d({name:"q1",set:"cell.data.q1(this.get)",req:["values"],idx:3}),q3:d({name:"q3",set:"cell.data.q3(this.get)",req:["values"],idx:3}),argmin:d({name:"argmin",init:"this.argmin = undefined;",add:"if (v < this.min) this.argmin = t;",rem:"if (v <= this.min) this.argmin = undefined;",set:"this.argmin || cell.data.argmin(this.get)",req:["min"],str:["values"],idx:3}),argmax:d({name:"argmax",init:"this.argmax = undefined;",add:"if (v > this.max) this.argmax = t;",rem:"if (v >= this.max) this.argmax = undefined;",set:"this.argmax || cell.data.argmax(this.get)",req:["max"],str:["values"],idx:3}),min:d({name:"min",init:"this.min = undefined;",add:"if (v < this.min || this.min === undefined) this.min = v;",rem:"if (v <= this.min) this.min = NaN;",set:"this.min = (isNaN(this.min) ? cell.data.min(this.get) : this.min)",str:["values"],idx:4}),max:d({name:"max",init:"this.max = undefined;",add:"if (v > this.max || this.max === undefined) this.max = v;",rem:"if (v >= this.max) this.max = NaN;",set:"this.max = (isNaN(this.max) ? cell.data.max(this.get) : this.max)",str:["values"],idx:4})},o=Object.keys(u);function l(e,t){return u[e](t)}function d(e){return function(i){var n=t.extend({init:"",add:"",rem:"",idx:0},e);return n.out=i||e.name,n}}function f(e,t){return e.idx-t.idx}function m(e,i){var n=i||t.identity,a=function(e,t){var i,n=e.reduce(function e(i,n){function a(t){i[t]||e(i,i[t]=u[t]())}return n.req&&n.req.forEach(a),t&&n.str&&n.str.forEach(a),i},e.reduce(function(e,t){return e[t.name]=t,e},{})),a=[];for(i in n)a.push(n[i]);return a.sort(f)}(e,!0),r="var cell = this.cell; this.valid = 0; this.missing = 0;",s="this.cell = cell; this.init();",o="if(v==null){++this.missing; return;} if(v!==v) return; ++this.valid;",l="if(v==null){--this.missing; return;} if(v!==v) return; --this.valid;",d="var cell = this.cell;";return a.forEach(function(e){r+=e.init,o+=e.add,l+=e.rem}),e.slice().sort(f).forEach(function(e){d+="t['"+e.out+"']="+e.set+";"}),d+="return t;",(s=Function("cell",s)).prototype.init=Function(r),s.prototype.add=Function("v","t",o),s.prototype.rem=Function("v","t",l),s.prototype.set=Function("t",d),s.prototype.get=n,s.fields=e.map(function(e){return e.out}),s}function h(e){this._key=e?t.field(e):i.tupleid,this.reset()}var c=h.prototype;function p(e){i.Transform.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}c.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},c.add=function(e){this._add.push(e)},c.rem=function(e){this._rem.push(e)},c.values=function(){if(this._get=null,0===this._rem.length)return this._add;var e,t,i,n=this._add,a=this._rem,r=this._key,s=n.length,u=a.length,o=Array(s-u),l={};for(e=0;e<u;++e)l[r(a[e])]=1;for(e=0,t=0;e<s;++e)l[r(i=n[e])]?l[r(i)]=0:o[t++]=i;return this._rem=[],this._add=o},c.distinct=function(e){for(var t,i=this.values(),n=i.length,a={},r=0;--n>=0;)t=e(i[n])+"",a.hasOwnProperty(t)||(a[t]=1,++r);return r},c.extent=function(e){if(this._get!==e||!this._ext){var i=this.values(),n=t.extentIndex(i,e);this._ext=[i[n[0]],i[n[1]]],this._get=e}return this._ext},c.argmin=function(e){return this.extent(e)[0]||{}},c.argmax=function(e){return this.extent(e)[1]||{}},c.min=function(e){var t=this.extent(e)[0];return null!=t?e(t):void 0},c.max=function(e){var t=this.extent(e)[1];return null!=t?e(t):void 0},c.quartile=function(e){return this._get===e&&this._q||(this._q=n.quartiles(this.values(),e),this._get=e),this._q},c.q1=function(e){return this.quartile(e)[0]},c.q2=function(e){return this.quartile(e)[1]},c.q3=function(e){return this.quartile(e)[2]},c.ci=function(e){return this._get===e&&this._ci||(this._ci=n.bootstrapCI(this.values(),1e3,.05,e),this._get=e),this._ci},c.ci0=function(e){return this.ci(e)[0]},c.ci1=function(e){return this.ci(e)[1]},p.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:o},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};var v=t.inherits(p,i.Transform);v.transform=function(e,t){var i,n=this,a=t.fork(t.NO_SOURCE|t.NO_FIELDS);return this.stamp=a.stamp,this.value&&((i=e.modified())||t.modified(this._inputs))?(this._prev=this.value,this.value=i?this.init(e):{},t.visit(t.SOURCE,function(e){n.add(e)})):(this.value=this.value||this.init(e),t.visit(t.REM,function(e){n.rem(e)}),t.visit(t.ADD,function(e){n.add(e)})),a.modifies(this._outputs),n._drop=!1!==e.drop,e.cross&&n._dims.length>1&&(n._drop=!1,this.cross()),n.changes(a)},v.cross=function(){var e=this,t=e.value,i=e._dnames,n=i.map(function(){return{}}),a=i.length;function r(e){var t,r,s,u;for(t in e)for(s=e[t].tuple,r=0;r<a;++r)n[r][u=s[i[r]]]=u}r(e._prev),r(t),function r(s,u,o){var l,d,f=i[o],m=n[o++];for(l in m)u[f]=m[l],d=s?s+"|"+l:l,o<a?r(d,u,o):t[d]||e.cell(d,u)}("",{},0)},v.init=function(e){var i=this._inputs=[],n=this._outputs=[],a={};function u(e){for(var n,r=t.array(t.accessorFields(e)),s=0,u=r.length;s<u;++s)a[n=r[s]]||(a[n]=1,i.push(n))}this._dims=t.array(e.groupby),this._dnames=this._dims.map(function(e){var i=t.accessorName(e);return u(e),n.push(i),i}),this.cellkey=e.key?e.key:r(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];var o,d,f,h,c,p,v=e.fields||[null],g=e.ops||["count"],y=e.as||[],_=v.length,x={};for(_!==g.length&&t.error("Unmatched number of fields and aggregate ops."),p=0;p<_;++p)o=v[p],d=g[p],null==o&&"count"!==d&&t.error("Null aggregate field specified."),c=s(d,h=t.accessorName(o),y[p]),n.push(c),"count"!==d?((f=x[h])||(u(o),(f=x[h]=[]).field=o,this._measures.push(f)),"count"!==d&&(this._countOnly=!1),f.push(l(d,c))):this._counts.push(c);return this._measures=this._measures.map(function(e){return m(e,e.field)}),{}},v.cellkey=r(),v.cell=function(e,t){var i=this.value[e];return i?0===i.num&&this._drop&&i.stamp<this.stamp?(i.stamp=this.stamp,this._adds[this._alen++]=i):i.stamp<this.stamp&&(i.stamp=this.stamp,this._mods[this._mlen++]=i):(i=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=i),i},v.newcell=function(e,t){var i={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){var n,a=this._measures,r=a.length;for(i.agg=Array(r),n=0;n<r;++n)i.agg[n]=new a[n](i)}return i.store&&(i.data=new h),i},v.newtuple=function(e,t){var n,a,r=this._dnames,s=this._dims,u={};for(n=0,a=s.length;n<a;++n)u[r[n]]=s[n](e);return t?i.replace(t.tuple,u):i.ingest(u)},v.add=function(e){var t,i,n,a=this.cellkey(e),r=this.cell(a,e);if(r.num+=1,!this._countOnly)for(r.store&&r.data.add(e),i=0,n=(t=r.agg).length;i<n;++i)t[i].add(t[i].get(e),e)},v.rem=function(e){var t,i,n,a=this.cellkey(e),r=this.cell(a,e);if(r.num-=1,!this._countOnly)for(r.store&&r.data.rem(e),i=0,n=(t=r.agg).length;i<n;++i)t[i].rem(t[i].get(e),e)},v.celltuple=function(e){var t,i,n,a=e.tuple,r=this._counts;for(e.store&&e.data.values(),i=0,n=r.length;i<n;++i)a[r[i]]=e.num;if(!this._countOnly)for(i=0,n=(t=e.agg).length;i<n;++i)t[i].set(a);return a},v.changes=function(e){var t,i,n,a,r=this._adds,s=this._mods,u=this._prev,o=this._drop,l=e.add,d=e.rem,f=e.mod;if(u)for(i in u)t=u[i],o&&!t.num||d.push(t.tuple);for(n=0,a=this._alen;n<a;++n)l.push(this.celltuple(r[n])),r[n]=null;for(n=0,a=this._mlen;n<a;++n)(0===(t=s[n]).num&&o?d:f).push(this.celltuple(t)),s[n]=null;return this._alen=this._mlen=0,this._prev=null,e};function g(e){i.Transform.call(this,null,e)}g.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};var y=t.inherits(g,i.Transform);function _(e,i,n){var a=e,r=i||[],s=n||[],u={},o=0;return{add:function(e){s.push(e)},remove:function(e){u[a(e)]=++o},size:function(){return r.length},data:function(e,i){return o&&(r=r.filter(function(e){return!u[a(e)]}),u={},o=0),i&&e&&r.sort(e),s.length&&(r=e?t.merge(e,r,s.sort(e)):r.concat(s),s=[]),r}}}function x(e){i.Transform.call(this,[],e)}function O(e){i.Operator.call(this,null,b,e)}function b(e){return this.value&&!e.modified()?this.value:t.compare(e.fields,e.orders)}function D(e){i.Transform.call(this,null,e)}y.transform=function(e,i){var n,a=this._bins(e),r=a.start,s=a.step,u=e.as||["bin0","bin1"],o=u[0],l=u[1];return n=e.modified()?(i=i.reflow(!0)).SOURCE:i.modified(t.accessorFields(e.field))?i.ADD_MOD:i.ADD,i.visit(n,function(e){var t=a(e);e[o]=t,e[l]=null==t?null:r+s*(1+(t-r)/s)}),i.modifies(u)},y._bins=function(e){if(this.value&&!e.modified())return this.value;var i,a,r=e.field,s=n.bin(e),u=s.start,o=s.stop,l=s.step;null!=(i=e.anchor)&&(a=i-(u+l*Math.floor((i-u)/l)),u+=a,o+=a);var d=function(e){var t=r(e);return null==t?null:(t=Math.max(u,Math.min(+t,o-l)),u+l*Math.floor(1e-14+(t-u)/l))};return d.start=u,d.stop=o,d.step=l,this.value=t.accessor(d,t.accessorFields(r),e.name||"bin_"+t.accessorName(r))},x.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},t.inherits(x,i.Transform).transform=function(e,t){var n=t.fork(t.ALL),a=_(i.tupleid,this.value,n.materialize(n.ADD).add),r=e.sort,s=t.changed()||r&&(e.modified("sort")||t.modified(r.fields));return n.visit(n.REM,a.remove),this.modified(s),this.value=n.source=a.data(r,s),t.source&&t.source.root&&(this.value.root=t.source.root),n},t.inherits(O,i.Operator),D.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};var E=t.inherits(D,i.Transform);function k(e){i.Transform.call(this,null,e)}E.transform=function(e,t){function i(t){return function(i){for(var n,a=function(e,t,i){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase()}return e.match(i)}(u(i),e.case,r)||[],o=0,l=a.length;o<l;++o)s.test(n=a[o])||t(n)}}var n=this._parameterCheck(e,t),a=this._counts,r=this._match,s=this._stop,u=e.field,o=e.as||["text","count"],l=i(function(e){a[e]=1+(a[e]||0)}),d=i(function(e){a[e]-=1});return n?t.visit(t.SOURCE,l):(t.visit(t.ADD,l),t.visit(t.REM,d)),this._finish(t,o)},E._parameterCheck=function(e,t){var i=!1;return!e.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),i=!0),!e.modified("pattern")&&this._match||(this._match=new RegExp(e.pattern||"[\\w']+","g"),i=!0),(e.modified("field")||t.modified(e.field.fields))&&(i=!0),i&&(this._counts={}),i},E._finish=function(e,t){var n,a,r,s=this._counts,u=this._tuples||(this._tuples={}),o=t[0],l=t[1],d=e.fork(e.NO_SOURCE|e.NO_FIELDS);for(n in s)a=u[n],r=s[n]||0,!a&&r?(u[n]=a=i.ingest({}),a[o]=n,a[l]=r,d.add.push(a)):0===r?(a&&d.rem.push(a),s[n]=null,u[n]=null):a[l]!==r&&(a[l]=r,d.mod.push(a));return d.modifies(t)},k.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},t.inherits(k,i.Transform).transform=function(e,n){var a=n.fork(n.NO_SOURCE),r=this.value,s=e.as||["a","b"],u=s[0],o=s[1];return!r||n.changed(n.ADD_REM)||e.modified("as")||e.modified("filter")?(r&&(a.rem=r),r=n.materialize(n.SOURCE).source,a.add=this.value=function(e,t,n,a){for(var r,s,u=[],o={},l=e.length,d=0;d<l;++d)for(o[t]=s=e[d],r=0;r<l;++r)o[n]=e[r],a(o)&&(u.push(i.ingest(o)),(o={})[t]=s);return u}(r,u,o,e.filter||t.truthy)):a.mod=r,a.source=this.value,a.modifies(s)};var q={kde:n.randomKDE,mixture:n.randomMixture,normal:n.randomNormal,uniform:n.randomUniform},w="distributions",T="function",N="field";function R(e){i.Transform.call(this,null,e)}var S=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],M={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:S},{name:"weights",type:"number",array:!0}]};function C(e){i.Operator.call(this,null,U,e),this.modified(!0)}function U(e){var i=e.expr;return this.value&&!e.modified("expr")?this.value:t.accessor(t=>i(t,e),t.accessorFields(i),t.accessorName(i))}function A(e){i.Transform.call(this,[void 0,void 0],e)}function F(e,t){i.Operator.call(this,e),this.parent=t}R.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:S.concat(M)},{name:"as",type:"string",array:!0,default:["value","density"]}]},t.inherits(R,i.Transform).transform=function(e,a){var r=a.fork(a.NO_SOURCE|a.NO_FIELDS);if(!this.value||a.changed()||e.modified()){var s=function e(i,n){var a=i[T];q.hasOwnProperty(a)||t.error("Unknown distribution function: "+a);var r=q[a]();for(var s in i)s===N?r.data((i.from||n()).map(i[s])):s===w?r[s](i[s].map(function(t){return e(t,n)})):typeof r[s]===T&&r[s](i[s]);return r}(e.distribution,function(e){return function(){return e.materialize(e.SOURCE).source}}(a)),u=e.steps||e.minsteps||25,o=e.steps||e.maxsteps||200,l=e.method||"pdf";"pdf"!==l&&"cdf"!==l&&t.error("Invalid density method: "+l),e.extent||s.data||t.error("Missing density extent parameter."),l=s[l];var d=e.as||["value","density"],f=e.extent||t.extent(s.data()),m=n.sampleCurve(l,f,u,o).map(e=>{var t={};return t[d[0]]=e[0],t[d[1]]=e[1],i.ingest(t)});this.value&&(r.rem=this.value),this.value=r.add=r.source=m}return r},t.inherits(C,i.Operator),A.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},t.inherits(A,i.Transform).transform=function(e,t){var i,n=this.value,a=e.field,r=n[0],s=n[1];((i=t.changed()||t.modified(a.fields)||e.modified("field"))||null==r)&&(r=1/0,s=-1/0),t.visit(i?t.SOURCE:t.ADD,function(e){var t=a(e);null!=t&&((t=+t)<r&&(r=t),t>s&&(s=t))}),isFinite(r)&&isFinite(s)||(r=s=void 0),this.value=[r,s]};var z=t.inherits(F,i.Operator);function L(e){i.Transform.call(this,{},e),this._keys=t.fastmap();var n=this._targets=[];n.active=0,n.forEach=function(e){for(var t=0,i=n.active;t<i;++t)e(n[t],t,n)}}z.connect=function(e){return this.targets().add(e),e.source=this},z.add=function(e){this.value.add.push(e)},z.rem=function(e){this.value.rem.push(e)},z.mod=function(e){this.value.mod.push(e)},z.init=function(e){this.value.init(e,e.NO_SOURCE)},z.evaluate=function(){return this.value};var I=t.inherits(L,i.Transform);function P(e){i.Operator.call(this,null,j,e)}function j(e){return this.value&&!e.modified()?this.value:t.isArray(e.name)?t.array(e.name).map(function(e){return t.field(e)}):t.field(e.name,e.as)}function K(e){i.Transform.call(this,t.fastmap(),e)}function W(e,i){return e?e.map(function(e,n){return i[n]||t.accessorName(e)}):null}function B(e){i.Transform.call(this,[],e)}function J(e){i.Transform.call(this,[],e)}function $(e){i.Transform.call(this,null,e)}function G(e){i.Transform.call(this,[],e)}I.activate=function(e){this._targets[this._targets.active++]=e},I.subflow=function(e,t,i,n){var a,r,s=this.value,u=s.hasOwnProperty(e)&&s[e];return u?u.value.stamp<i.stamp&&(u.init(i),this.activate(u)):(r=n||(r=this._group[e])&&r.tuple,u=(a=i.dataflow).add(new F(i.fork(i.NO_SOURCE),this)).connect(t(a,e,r)),s[e]=u,this.activate(u)),u},I.transform=function(e,t){var n=t.dataflow,a=this,r=e.key,s=e.subflow,u=this._keys,o=e.modified("key");function l(e){return a.subflow(e,s,t)}return this._group=e.group||{},this._targets.active=0,t.visit(t.REM,function(e){var t=i.tupleid(e),n=u.get(t);void 0!==n&&(u.delete(t),l(n).rem(e))}),t.visit(t.ADD,function(e){var t=r(e);u.set(i.tupleid(e),t),l(t).add(e)}),o||t.modified(r.fields)?t.visit(t.MOD,function(e){var t=i.tupleid(e),n=u.get(t),a=r(e);n===a?l(a).mod(e):(u.set(t,a),l(n).rem(e),l(a).add(e))}):t.changed(t.MOD)&&t.visit(t.MOD,function(e){l(u.get(i.tupleid(e))).mod(e)}),o&&t.visit(t.REFLOW,function(e){var t=i.tupleid(e),n=u.get(t),a=r(e);n!==a&&(u.set(t,a),l(n).rem(e),l(a).add(e))}),u.empty>n.cleanThreshold&&n.runAfter(u.clean),t},t.inherits(P,i.Operator),K.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},t.inherits(K,i.Transform).transform=function(e,t){var n=t.dataflow,a=this.value,r=t.fork(),s=r.add,u=r.rem,o=r.mod,l=e.expr,d=!0;function f(t){var n=i.tupleid(t),r=l(t,e),f=a.get(n);r&&f?(a.delete(n),s.push(t)):r||f?d&&r&&!f&&o.push(t):(a.set(n,1),u.push(t))}return t.visit(t.REM,function(e){var t=i.tupleid(e);a.has(t)?a.delete(t):u.push(e)}),t.visit(t.ADD,function(t){l(t,e)?s.push(t):a.set(i.tupleid(t),1)}),t.visit(t.MOD,f),e.modified()&&(d=!1,t.visit(t.REFLOW,f)),a.empty>n.cleanThreshold&&n.runAfter(a.clean),r},B.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0}]},t.inherits(B,i.Transform).transform=function(e,t){var n=t.fork(t.NO_SOURCE),a=e.fields,r=W(a,e.as||[]),s=r.length;return n.rem=this.value,t.visit(t.SOURCE,function(e){for(var t,u,o,l=a.map(function(t){return t(e)}),d=l.reduce(function(e,t){return Math.max(e,t.length)},0),f=0;f<d;++f){for(u=i.derive(e),t=0;t<s;++t)u[r[t]]=null==(o=l[t][f])?null:o;n.add.push(u)}}),this.value=n.source=n.add,n.modifies(r)},J.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},t.inherits(J,i.Transform).transform=function(e,n){var a=n.fork(n.NO_SOURCE),r=e.fields,s=r.map(t.accessorName),u=e.as||["key","value"],o=u[0],l=u[1],d=r.length;return a.rem=this.value,n.visit(n.SOURCE,function(e){for(var t,n=0;n<d;++n)(t=i.derive(e))[o]=s[n],t[l]=r[n](e),a.add.push(t)}),this.value=a.source=a.add,a.modifies(u)},$.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},t.inherits($,i.Transform).transform=function(e,t){var i=e.expr,n=e.as,a=e.modified(),r=e.initonly?t.ADD:a?t.SOURCE:t.modified(i.fields)?t.ADD_MOD:t.ADD;return a&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(n),t.visit(r,function(t){t[n]=i(t,e)})},t.inherits(G,i.Transform).transform=function(e,t){var n,a,r,s=this.value,u=t.fork(t.ALL),o=e.size-s.length,l=e.generator;if(o>0){for(n=[];--o>=0;)n.push(r=i.ingest(l(e))),s.push(r);u.add=u.add.length?u.materialize(u.ADD).add.concat(n):n}else a=s.slice(0,-o),u.rem=u.rem.length?u.materialize(u.REM).rem.concat(a):a,s=s.slice(-o);return u.source=this.value=s,u};var H={value:"value",median:a.median,mean:a.mean,min:a.min,max:a.max},Q=[];function V(e){i.Transform.call(this,[],e)}function X(e){p.call(this,e)}V.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},t.inherits(V,i.Transform).transform=function(e,n){var a,r,s,u,o,l,d,f,m,h,c=n.fork(n.ALL),p=function(e){var i,n=e.method||H.value;if(null!=H[n])return n===H.value?(i=void 0!==e.value?e.value:0,function(){return i}):H[n];t.error("Unrecognized imputation method: "+n)}(e),v=function(e){var t=e.field;return function(e){return e?t(e):NaN}}(e),g=t.accessorName(e.field),y=t.accessorName(e.key),_=(e.groupby||[]).map(t.accessorName),x=function(e,t,i,n){var a,r,s,u,o,l,d,f,m=function(e){return e(f)},h=[],c=n?n.slice():[],p={},v={};for(c.forEach(function(e,t){p[e]=t+1}),u=0,d=e.length;u<d;++u)f=e[u],l=i(f),o=p[l]||(p[l]=c.push(l)),r=(a=t?t.map(m):Q)+"",(s=v[r])||(s=v[r]=[],h.push(s),s.values=a),s[o-1]=f;return h.domain=c,h}(n.source,e.groupby,e.key,e.keyvals),O=[],b=this.value,D=x.domain.length;for(o=0,f=x.length;o<f;++o)for(s=(a=x[o]).values,r=NaN,d=0;d<D;++d)if(null==a[d]){for(u=x.domain[d],h={_impute:!0},l=0,m=s.length;l<m;++l)h[_[l]]=s[l];h[y]=u,h[g]=isNaN(r)?r=p(a,v):r,O.push(i.ingest(h))}return O.length&&(c.add=c.materialize(c.ADD).add.concat(O)),b.length&&(c.rem=c.materialize(c.REM).rem.concat(b)),this.value=O,c},X.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:o},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};var Y=t.inherits(X,p);function Z(e){i.Transform.call(this,null,e)}function ee(e){i.Operator.call(this,null,te,e)}function te(e){return this.value&&!e.modified()?this.value:t.key(e.fields,e.flat)}function ie(e){i.Transform.call(this,[],e)}function ne(e,t,n){n.forEach(i.ingest);const a=t.fork(t.NO_FIELDS&t.NO_SOURCE);return a.rem=e.value,e.value=a.add=a.source=n,a}function ae(e){i.Transform.call(this,{},e)}function re(e){i.Operator.call(this,null,se,e)}function se(e){if(this.value&&!e.modified())return this.value;var t,i,n,a=1/0,r=-1/0,s=e.extents;for(t=0,i=s.length;t<i;++t)(n=s[t])[0]<a&&(a=n[0]),n[1]>r&&(r=n[1]);return[a,r]}function ue(e){i.Operator.call(this,null,oe,e)}function oe(e){return this.value&&!e.modified()?this.value:e.values.reduce(function(e,t){return e.concat(t)},[])}function le(e){i.Transform.call(this,null,e)}function de(e){p.call(this,e)}Y.transform=function(e,i){var n,a=this,r=e.modified();return a.value&&(r||i.modified(a._inputs))?(n=a.value=r?a.init(e):{},i.visit(i.SOURCE,function(e){a.add(e)})):(n=a.value=a.value||this.init(e),i.visit(i.REM,function(e){a.rem(e)}),i.visit(i.ADD,function(e){a.add(e)})),a.changes(),i.visit(i.SOURCE,function(e){t.extend(e,n[a.cellkey(e)].tuple)}),i.reflow(r).modifies(this._outputs)},Y.changes=function(){var e,t,i=this._adds,n=this._mods;for(e=0,t=this._alen;e<t;++e)this.celltuple(i[e]),i[e]=null;for(e=0,t=this._mlen;e<t;++e)this.celltuple(n[e]),n[e]=null;this._alen=this._mlen=0},Z.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},t.inherits(Z,i.Transform).transform=function(e,r){var s=r.fork(r.NO_SOURCE|r.NO_FIELDS);if(!this.value||r.changed()||e.modified()){const u=function(e,t,i){var n,a,r,s,u,o,l=[],d=function(e){return e(s)};if(null==t)l.push(e.map(i));else for(n={},a=0,r=e.length;a<r;++a)s=e[a],u=t.map(d),(o=n[u])||(n[u]=o=[],o.dims=u,l.push(o)),o.push(i(s));return l}(r.materialize(r.SOURCE).source,e.groupby,e.field),o=(e.groupby||[]).map(t.accessorName),l=e.bandwidth,d=e.cumulative?"cdf":"pdf",f=e.steps||e.minsteps||25,m=e.steps||e.maxsteps||200,h=e.as||["value","density"],c=[];"pdf"!==d&&"cdf"!==d&&t.error("Invalid density method: "+d),u.forEach(t=>{const r=n.randomKDE(t,l)[d],s=e.counts?t.length:1,u=e.extent||a.extent(t);n.sampleCurve(r,u,f,m).forEach(e=>{const n={};for(let e=0;e<o.length;++e)n[o[e]]=t.dims[e];n[h[0]]=e[0],n[h[1]]=e[1]*s,c.push(i.ingest(n))})}),this.value&&(s.rem=this.value),this.value=s.add=s.source=c}return s},t.inherits(ee,i.Operator),t.inherits(ie,i.Transform).transform=function(e,t){const i=t.dataflow;return e.values?ne(this,t,i.parse(e.values,e.format)):i.request(e.url,e.format).then(e=>ne(this,t,e.data||[]))},ae.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},t.inherits(ae,i.Transform).transform=function(e,i){var n,a,r=i,s=e.as,u=e.fields,o=e.index,l=e.values,d=null==e.default?null:e.default,f=e.modified(),m=f?i.SOURCE:i.ADD,h=u.length;return l?(a=l.length,h>1&&!s&&t.error('Multi-field lookup requires explicit "as" parameter.'),s&&s.length!==h*a&&t.error('The "as" parameter has too few output field names.'),s=s||l.map(t.accessorName),n=function(e){for(var t,i,n=0,r=0;n<h;++n)if(null==(i=o.get(u[n](e))))for(t=0;t<a;++t,++r)e[s[r]]=d;else for(t=0;t<a;++t,++r)e[s[r]]=l[t](i)}):(s||t.error("Missing output field names."),n=function(e){for(var t,i=0;i<h;++i)t=o.get(u[i](e)),e[s[i]]=null==t?d:t}),f?r=i.reflow(!0):m|=u.some(function(e){return i.modified(e.fields)})?i.MOD:0,i.visit(m,n),r.modifies(s)},t.inherits(re,i.Operator),t.inherits(ue,i.Operator),t.inherits(le,i.Transform),le.prototype.transform=function(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)},de.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:o,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};var fe=t.inherits(de,p);function me(e){L.call(this,e)}function he(e){i.Transform.call(this,null,e)}function ce(e){i.Transform.call(this,null,e)}function pe(e){i.Transform.call(this,null,e)}function ve(e){i.Transform.call(this,[],e),this.count=0}function ge(e){i.Transform.call(this,null,e)}function ye(e){i.Transform.call(this,null,e),this.modified(!0)}function _e(e){i.Transform.call(this,t.fastmap(),e)}function xe(e){i.Transform.call(this,null,e)}fe._transform=fe.transform,fe.transform=function(e,i){return this._transform(function(e,i){var n=e.field,a=e.value,r=("count"===e.op?"__count__":e.op)||"sum",s=t.accessorFields(n).concat(t.accessorFields(a)),u=function(e,t,i){var n={},a=[];return i.visit(i.SOURCE,function(t){var i=e(t);n[i]||(n[i]=1,a.push(i))}),a.sort(function(e,t){return(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t==t?-1:t!=t&&e==e?1:0)}),t?a.slice(0,t):a}(n,e.limit||0,i);return{key:e.key,groupby:e.groupby,ops:u.map(function(){return r}),fields:u.map(function(e){return function(e,i,n,a){return t.accessor(function(t){return i(t)===e?n(t):NaN},a,e+"")}(e,n,a,s)}),as:u.map(function(e){return e+""}),modified:e.modified.bind(e)}}(e,i),i)},t.inherits(me,L).transform=function(e,n){var a=this,r=e.subflow,s=e.field;return(e.modified("field")||s&&n.modified(t.accessorFields(s)))&&t.error("PreFacet does not support field modification."),this._targets.active=0,n.visit(n.MOD,function(e){var t=a.subflow(i.tupleid(e),r,n,e);s?s(e).forEach(function(e){t.mod(e)}):t.mod(e)}),n.visit(n.ADD,function(e){var t=a.subflow(i.tupleid(e),r,n,e);s?s(e).forEach(function(e){t.add(i.ingest(e))}):t.add(e)}),n.visit(n.REM,function(e){var t=a.subflow(i.tupleid(e),r,n,e);s?s(e).forEach(function(e){t.rem(e)}):t.rem(e)}),n},he.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},t.inherits(he,i.Transform).transform=function(e,t){var n,a,r=e.fields,s=W(e.fields,e.as||[]),u=r?function(e,t){return function(e,t,i,n){for(var a=0,r=i.length;a<r;++a)t[n[a]]=i[a](e);return t}(e,t,r,s)}:i.rederive;return this.value?a=this.value:(t=t.addAll(),a=this.value={}),n=t.fork(t.NO_SOURCE),t.visit(t.REM,function(e){var t=i.tupleid(e);n.rem.push(a[t]),a[t]=null}),t.visit(t.ADD,function(e){var t=u(e,i.ingest({}));a[i.tupleid(e)]=t,n.add.push(t)}),t.visit(t.MOD,function(e){n.mod.push(u(e,a[i.tupleid(e)]))}),n},t.inherits(ce,i.Transform).transform=function(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation},t.inherits(pe,i.Transform).transform=function(e,t){var n,a;return this.value?a=this.value:(n=t=t.addAll(),a=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,function(e){var t=i.tupleid(e);n.rem.push(a[t]),a[t]=null}),t.visit(t.ADD,function(e){var t=i.derive(e);a[i.tupleid(e)]=t,n.add.push(t)}),t.visit(t.MOD,function(e){n.mod.push(i.rederive(e,a[i.tupleid(e)]))})),n},ve.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},t.inherits(ve,i.Transform).transform=function(e,t){var a=t.fork(t.NO_SOURCE),r=e.modified("size"),s=e.size,u=this.value,o=this.count,l=0,d=u.reduce(function(e,t){return e[i.tupleid(t)]=1,e},{});function f(e){var t,r;u.length<s?u.push(e):(r=~~((o+1)*n.random()))<u.length&&r>=l&&(t=u[r],d[i.tupleid(t)]&&a.rem.push(t),u[r]=e),++o}if(t.rem.length&&(t.visit(t.REM,function(e){var t=i.tupleid(e);d[t]&&(d[t]=-1,a.rem.push(e)),--o}),u=u.filter(function(e){return-1!==d[i.tupleid(e)]})),(t.rem.length||r)&&u.length<s&&t.source&&(l=o=u.length,t.visit(t.SOURCE,function(e){d[i.tupleid(e)]||f(e)}),l=-1),r&&u.length>s){for(var m=0,h=u.length-s;m<h;++m)d[i.tupleid(u[m])]=-1,a.rem.push(u[m]);u=u.slice(h)}return t.mod.length&&t.visit(t.MOD,function(e){d[i.tupleid(e)]&&a.mod.push(e)}),t.add.length&&t.visit(t.ADD,f),(t.add.length||l<0)&&(a.add=u.filter(function(e){return!d[i.tupleid(e)]})),this.count=o,this.value=a.source=u,a},ge.Definition={type:"Sequence",metadata:{changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},t.inherits(ge,i.Transform).transform=function(e,t){if(!this.value||e.modified()){var n=t.materialize().fork(t.MOD),r=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=a.range(e.start,e.stop,e.step||1).map(function(e){var t={};return t[r]=e,i.ingest(t)}),n.add=t.add.concat(this.value),n}},t.inherits(ye,i.Transform).transform=function(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation},t.inherits(_e,i.Transform).transform=function(e,t){var i=t.dataflow,n=e.field,a=this.value,r=!0;function s(e){a.set(n(e),e)}return e.modified("field")||t.modified(n.fields)?(a.clear(),t.visit(t.SOURCE,s)):t.changed()?(t.visit(t.REM,function(e){a.delete(n(e))}),t.visit(t.ADD,s)):r=!1,this.modified(r),a.empty>i.cleanThreshold&&i.runAfter(a.clean),t.fork()},t.inherits(xe,i.Transform).transform=function(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(e.sort):t.source).map(e.field))};const Oe={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{let i=t.index,n=t.data;return i&&t.compare(n[i-1],n[i])?e=i+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{let i=t.index,n=t.data;return i&&t.compare(n[i-1],n[i])?++e:e}}},percent_rank:function(){let e=Oe.rank(),t=e.next;return{init:e.init,next:e=>(t(e)-1)/(e.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{let i=t.index,n=t.data,a=t.compare;if(e<i){for(;i+1<n.length&&!a(n[i],n[i+1]);)++i;e=i}return(1+e)/n.length}}},ntile:function(e,i){(i=+i)>0||t.error("ntile num must be greater than zero.");let n=Oe.cume_dist(),a=n.next;return{init:n.init,next:e=>Math.ceil(i*a(e))}},lag:function(e,t){return t=+t||1,{next:i=>{let n=i.index-t;return n>=0?e(i.data[n]):null}}},lead:function(e,t){return t=+t||1,{next:i=>{let n=i.index+t,a=i.data;return n<a.length?e(a[n]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,i){return(i=+i)>0||t.error("nth_value nth must be greater than zero."),{next:t=>{let n=t.i0+(i-1);return n<t.i1?e(t.data[n]):null}}},prev_value:function(e){let t=null;return{next:i=>{let n=e(i.data[i.index]);return null!=n?t=n:t}}},next_value:function(e){let t=null,i=-1;return{next:n=>{let a=n.data;return n.index<=i?t:(i=function(e,t,i){for(let n=t.length;i<n;++i){let n=e(t[i]);if(null!=n)return i}return-1}(e,a,n.index))<0?(i=a.length,t=null):t=e(a[i])}}}};var be=Object.keys(Oe);function De(e){let i=this,n=t.array(e.ops),a=t.array(e.fields),r=t.array(e.params),u=t.array(e.as),o=i.outputs=[],d=i.windows=[],f={},c={},p=!0,v=[],g=[];function y(e){t.array(t.accessorFields(e)).forEach(e=>f[e]=1)}y(e.sort),n.forEach(function(e,i){let n=a[i],f=t.accessorName(n),m=s(e,f,u[i]);if(y(n),o.push(m),Oe.hasOwnProperty(e))d.push(function(e,i,n,a){let r=Oe[e](i,n);return{init:r.init||t.zero,update:function(e,t){t[a]=r.next(e)}}}(e,a[i],r[i],m));else{if(null==n&&"count"!==e&&t.error("Null aggregate field specified."),"count"===e)return void v.push(m);p=!1;let i=c[f];i||((i=c[f]=[]).field=n,g.push(i)),i.push(l(e,m))}}),(v.length||g.length)&&(i.cell=function(e,t,i){e=e.map(e=>m(e,e.field));let n={num:0,agg:null,store:!1,count:t};if(!i)for(var a=e.length,r=n.agg=Array(a),s=0;s<a;++s)r[s]=new e[s](n);if(n.store)var u=n.data=new h;return n.add=function(e){if(n.num+=1,!i){u&&u.add(e);for(let t=0;t<a;++t)r[t].add(r[t].get(e),e)}},n.rem=function(e){if(n.num-=1,!i){u&&u.rem(e);for(let t=0;t<a;++t)r[t].rem(r[t].get(e),e)}},n.set=function(e){let a,s;for(u&&u.values(),a=0,s=t.length;a<s;++a)e[t[a]]=n.num;if(!i)for(a=0,s=r.length;a<s;++a)r[a].set(e)},n.init=function(){n.num=0,u&&u.reset();for(let e=0;e<a;++e)r[e].init()},n}(g,v,p)),i.inputs=Object.keys(f)}const Ee=De.prototype;function ke(e){i.Transform.call(this,{},e),this._mlen=0,this._mods=[]}Ee.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()},Ee.update=function(e,t){let i,n=this.cell,a=this.windows,r=e.data,s=a&&a.length;if(n){for(i=e.p0;i<e.i0;++i)n.rem(r[i]);for(i=e.p1;i<e.i1;++i)n.add(r[i]);n.set(t)}for(i=0;i<s;++i)a[i].update(e,t)},ke.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:be.concat(o)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};var qe=t.inherits(ke,i.Transform);function we(e,i,n){var r=n.sort,s=r&&!n.ignorePeers,u=n.frame||[null,0],o=e.data(r),l=o.length,d=0,f=s?a.bisector(r):null,m={i0:0,i1:0,p0:0,p1:0,index:0,data:o,compare:r||t.constant(-1)};for(i.init();d<l;++d)Te(m,u,d,l),s&&Ne(m,f),i.update(m,o[d])}function Te(e,t,i,n){e.p0=e.i0,e.p1=e.i1,e.i0=null==t[0]?0:Math.max(0,i-Math.abs(t[0])),e.i1=null==t[1]?n:Math.min(n,i+Math.abs(t[1])+1),e.index=i}function Ne(e,t){var i=e.i0,n=e.i1-1,a=e.compare,r=e.data,s=r.length-1;i>0&&!a(r[i],r[i-1])&&(e.i0=t.left(r,r[i])),n<s&&!a(r[n],r[n+1])&&(e.i1=t.right(r,r[n]))}qe.transform=function(e,t){var i,n,a=this,s=a.state,u=e.modified();this.stamp=t.stamp,s&&!u||(s=a.state=new De(e));var o=r(e.groupby);function l(e){return a.group(o(e))}for(u||t.modified(s.inputs)?(a.value={},t.visit(t.SOURCE,function(e){l(e).add(e)})):(t.visit(t.REM,function(e){l(e).remove(e)}),t.visit(t.ADD,function(e){l(e).add(e)})),i=0,n=a._mlen;i<n;++i)we(a._mods[i],s,e);return a._mlen=0,a._mods=[],t.reflow(u).modifies(s.outputs)},qe.group=function(e){var t=this.value[e];return t||((t=this.value[e]=_(i.tupleid)).stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t},e.aggregate=p,e.bin=g,e.collect=x,e.compare=O,e.countpattern=D,e.cross=k,e.density=R,e.expression=C,e.extent=A,e.facet=L,e.field=P,e.filter=K,e.flatten=B,e.fold=J,e.formula=$,e.generate=G,e.impute=V,e.joinaggregate=X,e.kde=Z,e.key=ee,e.load=ie,e.lookup=ae,e.multiextent=re,e.multivalues=ue,e.params=le,e.pivot=de,e.prefacet=me,e.project=he,e.proxy=ce,e.relay=pe,e.sample=ve,e.sequence=ge,e.sieve=ye,e.subflow=F,e.tupleindex=_e,e.values=xe,e.window=ke,Object.defineProperty(e,"__esModule",{value:!0})});